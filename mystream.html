<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="referrer" content="strict-origin-when-cross-origin">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Hwang's Private Stream</title>
<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.12/hls.min.js"></script>
<style>
:root {
  --bg:#09090f; --surface:#111118; --surface2:#18181f; --surface3:#1f1f2a;
  --border:#252535; --border2:#2e2e42;
  --accent:#c0392b; --accent2:#e74c3c;
  --text:#ececf4; --text2:#8888aa; --text3:#555570;
  --live:#2ecc71; --youtube:#ff0000; --m3u:#3b82f6; --custom:#a855f7; --fav:#f59e0b;
  --sw:272px; --hh:56px;
}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
html,body{height:100%;overflow:hidden;}
body{background:var(--bg);color:var(--text);font-family:'Noto Sans KR',sans-serif;}

/* HEADER */
header{position:fixed;top:0;left:0;right:0;z-index:300;height:var(--hh);display:flex;align-items:center;gap:10px;padding:0 14px;background:rgba(9,9,15,.97);border-bottom:1px solid var(--border);backdrop-filter:blur(20px);}
.logo{font-family:'Black Han Sans',sans-serif;font-size:11px;color:var(--text2);white-space:nowrap;flex-shrink:0;line-height:1.3;}
.logo strong{display:block;font-size:14px;color:var(--accent);letter-spacing:1.5px;}
.h-space{flex:1;}
.live-dot{width:7px;height:7px;border-radius:50%;background:var(--live);flex-shrink:0;animation:pulse 2s infinite;}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 0 0 rgba(46,204,113,.5)}50%{opacity:.6;box-shadow:0 0 0 5px rgba(46,204,113,0)}}
@keyframes spin{to{transform:rotate(360deg)}}
@keyframes slideUp{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;gap:5px;padding:7px 13px;border-radius:7px;border:none;cursor:pointer;font-family:'Noto Sans KR',sans-serif;font-size:12px;font-weight:500;transition:all .18s;white-space:nowrap;}
.btn-p{background:var(--accent);color:#fff;} .btn-p:hover{background:var(--accent2);}
.btn-g{background:transparent;color:var(--text2);border:1px solid var(--border2);} .btn-g:hover{border-color:var(--accent);color:var(--accent);}
.btn-sm{padding:5px 10px;font-size:11px;}

/* LAYOUT */
.app{display:flex;height:100vh;padding-top:var(--hh);}

/* SIDEBAR */
.sidebar{width:var(--sw);flex-shrink:0;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;height:100%;overflow:hidden;transition:transform .28s cubic-bezier(.4,0,.2,1);}
.sb-tabs{display:flex;border-bottom:1px solid var(--border);flex-shrink:0;}
.stab{flex:1;padding:10px 4px;text-align:center;font-size:11px;font-weight:600;color:var(--text2);cursor:pointer;border-bottom:2px solid transparent;transition:all .15s;user-select:none;}
.stab.on{color:var(--accent);border-bottom-color:var(--accent);}
.spanel{display:none;flex-direction:column;flex:1;overflow-y:auto;overflow-x:hidden;}
.spanel.on{display:flex;}
.cat-bar{display:flex;gap:5px;padding:8px 10px;overflow-x:auto;flex-shrink:0;border-bottom:1px solid var(--border);}
.cat-bar::-webkit-scrollbar{height:0;}
.cat-chip{padding:3px 10px;border-radius:20px;font-size:10px;font-weight:600;border:1px solid var(--border2);color:var(--text2);background:transparent;cursor:pointer;white-space:nowrap;transition:all .15s;flex-shrink:0;}
.cat-chip.on{background:rgba(192,57,43,.15);border-color:var(--accent);color:var(--accent);}
.ch-list{padding:6px;flex:1;}
.chi{display:flex;align-items:center;gap:8px;padding:8px 9px;border-radius:8px;cursor:pointer;transition:background .12s;position:relative;margin-bottom:1px;}
.chi:hover{background:var(--surface2);}
.chi.on{background:rgba(192,57,43,.1);}
.chi.on::before{content:'';position:absolute;left:0;top:5px;bottom:5px;width:3px;border-radius:0 3px 3px 0;background:var(--accent);}
.ch-ico{width:32px;height:32px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;}
.ch-ico.youtube{background:rgba(255,0,0,.12);color:var(--youtube);}
.ch-ico.m3u{background:rgba(59,130,246,.12);color:var(--m3u);}
.ch-ico.custom{background:rgba(168,85,247,.12);color:var(--custom);}
.ch-inf{flex:1;min-width:0;}
.ch-nm{font-size:12px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.ch-mt{font-size:10px;color:var(--text2);margin-top:1px;}
.ch-acts{display:flex;gap:2px;flex-shrink:0;}
.ich{background:none;border:none;color:var(--text3);font-size:13px;cursor:pointer;padding:3px 4px;border-radius:4px;transition:all .15s;line-height:1;}
.ich:hover{color:var(--accent);background:rgba(192,57,43,.12);}
.ich.fon{color:var(--fav);}

/* MAIN */
.main{flex:1;display:flex;flex-direction:column;overflow:hidden;min-width:0;}
.mscroll{flex:1;overflow-y:auto;overflow-x:hidden;}

/* PLAYER */
.pw{padding:13px 14px 8px;}
.pbox{position:relative;width:100%;aspect-ratio:16/9;background:#000;border-radius:10px;overflow:hidden;box-shadow:0 14px 44px rgba(0,0,0,.75);}
.pbox iframe,.pbox video{width:100%;height:100%;border:none;display:block;}
.pph{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;color:var(--text2);gap:10px;}
.pph .icon{font-size:46px;opacity:.18;}
.pph p{font-size:13px;}
#ytp{display:none;width:100%;height:100%;position:relative;}
.pinfo{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;padding:9px 0 0;flex-wrap:wrap;}
.ptitle{font-size:15px;font-weight:700;line-height:1.3;}
.psub{font-size:11px;color:var(--text2);margin-top:3px;}
.pacts{display:flex;gap:5px;flex-shrink:0;flex-wrap:wrap;}
.tbadge{padding:3px 9px;border-radius:20px;font-size:10px;font-weight:700;letter-spacing:.8px;text-transform:uppercase;}
.tbadge.youtube{background:rgba(255,0,0,.15);color:var(--youtube);border:1px solid rgba(255,0,0,.2);}
.tbadge.m3u{background:rgba(59,130,246,.15);color:var(--m3u);border:1px solid rgba(59,130,246,.2);}
.tbadge.custom{background:rgba(168,85,247,.15);color:var(--custom);border:1px solid rgba(168,85,247,.2);}

/* MULTIVIEW */
.mvbox{display:none;width:100%;aspect-ratio:16/9;background:#000;border-radius:10px;overflow:hidden;box-shadow:0 14px 44px rgba(0,0,0,.75);}
.mvbox.on{display:grid;}
.mv2{grid-template-columns:1fr 1fr;}
.mv4{grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;}
.mvc{position:relative;background:#0a0a12;border:1px solid var(--border);overflow:hidden;}
.mvc iframe,.mvc video{width:100%;height:100%;border:none;display:block;}
.mvlabel{position:absolute;bottom:0;left:0;right:0;padding:4px 8px;background:rgba(0,0,0,.75);font-size:10px;color:#fff;display:flex;justify-content:space-between;}
.mvempty{display:flex;align-items:center;justify-content:center;height:100%;color:var(--text2);font-size:11px;flex-direction:column;gap:5px;}

/* SEARCH BAR */
.sbar{display:flex;align-items:center;background:var(--surface2);border:1px solid var(--border2);border-radius:8px;padding:0 12px;gap:8px;margin:0 14px 11px;}
.sbar input{background:none;border:none;flex:1;padding:8px 0;color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:13px;outline:none;}

/* RECENT */
.rcwrap{padding:0 14px 9px;}
.rclabel{font-size:10px;font-weight:700;color:var(--text2);letter-spacing:1.5px;text-transform:uppercase;margin-bottom:5px;}
.rclist{display:flex;gap:6px;overflow-x:auto;padding-bottom:2px;}
.rclist::-webkit-scrollbar{height:3px;}
.rclist::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px;}
.rcchip{display:flex;align-items:center;gap:5px;padding:5px 10px;background:var(--surface2);border:1px solid var(--border2);border-radius:7px;cursor:pointer;white-space:nowrap;font-size:11px;transition:all .15s;flex-shrink:0;}
.rcchip:hover{border-color:var(--accent);color:var(--accent);}

/* GRID */
.ghdr{display:flex;align-items:center;justify-content:space-between;padding:0 14px 9px;}
.gtitle{font-family:'Black Han Sans',sans-serif;font-size:15px;letter-spacing:1px;}
.cgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(148px,1fr));gap:10px;padding:0 14px 20px;}
.ccard{background:var(--surface);border-radius:9px;overflow:hidden;cursor:pointer;transition:all .18s;border:1px solid var(--border);}
.ccard:hover{transform:translateY(-3px);border-color:var(--accent);box-shadow:0 8px 24px rgba(192,57,43,.15);}
.ccard.on{border-color:var(--accent);box-shadow:0 0 0 2px rgba(192,57,43,.2);}
.cthumb{aspect-ratio:16/9;display:flex;align-items:center;justify-content:center;font-size:24px;position:relative;}
.cthumb.youtube-bg{background:linear-gradient(135deg,#1a0000,#2d0000);}
.cthumb.m3u-bg{background:linear-gradient(135deg,#001233,#001a55);}
.cthumb.custom-bg{background:linear-gradient(135deg,#1a0033,#2d005e);}
.clive{position:absolute;top:5px;left:5px;background:var(--live);color:#fff;font-size:8px;font-weight:700;padding:2px 5px;border-radius:3px;letter-spacing:1px;}
.cfav{position:absolute;top:5px;right:5px;font-size:12px;color:var(--fav);}
.cbody{padding:8px 9px;}
.cname{font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;margin-bottom:3px;}
.cfoot{display:flex;align-items:center;justify-content:space-between;font-size:10px;color:var(--text2);}
.ctag{padding:1px 5px;border-radius:8px;background:var(--surface2);border:1px solid var(--border);}
.dbtn{background:none;border:none;color:var(--text3);cursor:pointer;font-size:13px;padding:1px 3px;transition:color .15s;}
.dbtn:hover{color:var(--accent);}

/* EPG */
.epgwrap{padding:0 14px 9px;}
.epgstrip{background:var(--surface);border-radius:8px;border:1px solid var(--border);padding:8px 12px;display:flex;align-items:center;gap:8px;overflow-x:auto;}
.epgi{flex-shrink:0;padding:5px 10px;border-radius:5px;background:var(--surface2);text-align:center;min-width:88px;}
.epgt{font-size:10px;color:var(--accent);font-weight:700;}
.epgs{font-size:11px;margin-top:1px;}
.epgi.now{background:rgba(192,57,43,.12);border:1px solid rgba(192,57,43,.2);}

/* HINT */
.hint{margin:0 14px 11px;background:rgba(59,130,246,.06);border:1px solid rgba(59,130,246,.15);border-radius:8px;padding:10px 13px;font-size:12px;color:var(--text2);line-height:1.8;}
.hint strong{color:var(--m3u);}

/* MODAL */
.overlay{display:none;position:fixed;inset:0;z-index:400;background:rgba(0,0,0,.88);backdrop-filter:blur(6px);align-items:center;justify-content:center;padding:14px;}
.overlay.on{display:flex;}
.modal{background:var(--surface);border-radius:14px;border:1px solid var(--border2);padding:22px;width:100%;max-width:510px;max-height:90vh;overflow-y:auto;animation:slideUp .2s ease;}
.mhead{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
.mtitle{font-family:'Black Han Sans',sans-serif;font-size:16px;}
.mclose{background:none;border:none;color:var(--text2);font-size:20px;cursor:pointer;padding:2px 6px;border-radius:5px;}
.mclose:hover{color:var(--text);}
.fg{margin-bottom:12px;}
label{display:block;font-size:10px;color:var(--text2);margin-bottom:5px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;}
input,select{width:100%;padding:8px 11px;background:var(--surface2);border:1px solid var(--border2);border-radius:7px;color:var(--text);font-family:'Noto Sans KR',sans-serif;font-size:13px;outline:none;transition:border-color .15s;}
input:focus,select:focus{border-color:var(--accent);}
select option{background:var(--surface2);}
.mfoot{display:flex;gap:7px;justify-content:flex-end;margin-top:16px;}
.ttabs{display:flex;gap:5px;margin-bottom:13px;flex-wrap:wrap;}
.ttab{padding:6px 11px;border-radius:7px;cursor:pointer;font-size:11px;border:1px solid var(--border2);color:var(--text2);background:transparent;transition:all .15s;font-family:'Noto Sans KR',sans-serif;font-weight:500;}
.ttab.on.youtube{border-color:var(--youtube);color:var(--youtube);background:rgba(255,0,0,.08);}
.ttab.on.m3u{border-color:var(--m3u);color:var(--m3u);background:rgba(59,130,246,.08);}
.ttab.on.custom{border-color:var(--custom);color:var(--custom);background:rgba(168,85,247,.08);}
.ttab.on.file{border-color:var(--m3u);color:var(--m3u);background:rgba(59,130,246,.08);}

/* DROP ZONE */
.dz{border:2px dashed var(--border2);border-radius:9px;padding:22px;text-align:center;color:var(--text2);cursor:pointer;transition:all .2s;margin-bottom:11px;}
.dz:hover,.dz.dzo{border-color:var(--m3u);background:rgba(59,130,246,.05);color:var(--m3u);}
.dz-icon{font-size:26px;margin-bottom:5px;}

/* SOURCE ITEM */
.srci{display:flex;align-items:center;gap:9px;padding:9px 10px;background:var(--surface2);border-radius:9px;border:1px solid var(--border);transition:border-color .15s;}
.srci:hover{border-color:var(--border2);}
.srcico{width:32px;height:32px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
.srcico.yt{background:rgba(255,0,0,.1);}
.srcico.hls{background:rgba(59,130,246,.1);}
.srcinf{flex:1;min-width:0;}
.srcnm{font-size:13px;font-weight:600;}
.srcdsc{font-size:11px;color:var(--text2);margin-top:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.srcact{display:flex;gap:4px;flex-shrink:0;}
.slabel{font-size:10px;font-weight:700;color:var(--text2);letter-spacing:1.5px;text-transform:uppercase;padding:11px 0 5px;}

/* ALL-SRC ITEM */
.asi{display:flex;align-items:center;gap:8px;padding:9px 10px;border-bottom:1px solid var(--border);transition:background .12s;}
.asi:hover{background:var(--surface2);}
.asi:last-child{border-bottom:none;}
.asiurl{font-size:10px;color:var(--text2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0;}

/* AI BADGE */
.aibadge{font-size:9px;font-weight:700;background:rgba(192,57,43,.15);color:var(--accent);border:1px solid rgba(192,57,43,.3);border-radius:10px;padding:2px 6px;white-space:nowrap;}
.aiitem{display:flex;align-items:flex-start;gap:9px;padding:9px 10px;background:var(--surface2);border-radius:9px;border:1px solid rgba(192,57,43,.2);}

/* TOAST */
.toast{position:fixed;bottom:18px;right:18px;z-index:9999;background:var(--surface2);border:1px solid var(--border2);border-radius:9px;padding:10px 15px;font-size:12px;animation:slideUp .2s ease;display:flex;align-items:center;gap:7px;max-width:290px;box-shadow:0 8px 24px rgba(0,0,0,.5);}
.toast.s{border-color:rgba(46,204,113,.35);}
.toast.e{border-color:rgba(192,57,43,.4);}

/* MOBILE */
.sbback{display:none;position:fixed;inset:0;z-index:250;background:rgba(0,0,0,.6);}
.mobmenu{display:none;background:none;border:none;color:var(--text);font-size:20px;cursor:pointer;padding:4px;flex-shrink:0;}

::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:4px;}

@media(max-width:768px){
  :root{--hh:50px;}
  .mobmenu{display:block;}
  .sidebar{position:fixed;top:0;left:0;bottom:0;z-index:260;transform:translateX(-100%);padding-top:var(--hh);}
  .sidebar.open{transform:translateX(0);}
  .sbback.open{display:block;}
  .main{width:100%;}
  .pw{padding:10px 11px 7px;}
  .cgrid{grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:8px;padding:0 11px 16px;}
  .sbar{margin:0 11px 10px;}
  .rcwrap,.ghdr,.epgwrap,.hint{padding-left:11px;padding-right:11px;}
  .modal{padding:16px;max-height:88vh;}
  .ptitle{font-size:13px;}
}
@media(max-width:390px){
  .cgrid{grid-template-columns:1fr 1fr;}
  .pinfo{flex-direction:column;gap:7px;}
  .pacts{width:100%;}
  .logo strong{font-size:12px;}
}

/* PROXY BANNER */
.proxy-banner{display:none;position:fixed;bottom:0;left:0;right:0;z-index:500;background:rgba(192,57,43,.97);color:#fff;font-size:11px;padding:8px 14px;display:flex;align-items:center;gap:8px;backdrop-filter:blur(10px);}
.proxy-banner.warn{background:rgba(180,90,0,.97);}
.proxy-banner.ok{background:rgba(30,130,60,.97);}
.proxy-banner a{color:#fff;text-decoration:underline;cursor:pointer;}
</style>
</head>
<body>

<div class="sbback" id="sbb" onclick="closeSB()"></div>

<header>
  <button class="mobmenu" onclick="openSB()">â˜°</button>
  <div class="logo">Hwang's<strong>PRIVATE STREAM</strong></div>
  <div class="h-space"></div>
  <div class="live-dot"></div>
  <button class="btn btn-g btn-sm" onclick="openM('allsrc')">ğŸ“‹ ì „ì²´ì†ŒìŠ¤</button>
  <button class="btn btn-g btn-sm" onclick="openM('srcsearch')">ğŸ” ì†ŒìŠ¤ê²€ìƒ‰</button>
  <button class="btn btn-p btn-sm" onclick="openM('addch')">ï¼‹ ì¶”ê°€</button>
  <button class="btn btn-g btn-sm" id="proxybtn" onclick="openProxyModal()" title="HLS í”„ë¡ì‹œ ì„¤ì •">âš™ï¸ í”„ë¡ì‹œ</button>
</header>

<div class="app">
  <aside class="sidebar" id="sb">
    <div class="sb-tabs">
      <div class="stab on" onclick="switchTab('my')">ğŸ“¡ ë‚´ì±„ë„</div>
      <div class="stab" onclick="switchTab('fav')">â­ ì¦ê²¨ì°¾ê¸°</div>
    </div>
    <div class="spanel on" id="p-my">
      <div class="cat-bar" id="catbar"></div>
      <div class="ch-list" id="sbch"></div>
    </div>
    <div class="spanel" id="p-fav">
      <div class="ch-list" id="sbfav"></div>
    </div>
  </aside>

  <main class="main">
    <div class="mscroll" id="ms">
      <div class="pw">
        <div class="pbox" id="pbox">
          <div class="pph" id="pph"><div class="icon">ğŸ“º</div><p>ì±„ë„ì„ ì„ íƒí•˜ë©´ ì—¬ê¸°ì„œ ì¬ìƒë©ë‹ˆë‹¤</p></div>
          <video id="hlsv" style="display:none" controls playsinline></video>
          <div id="ytp"></div>
          <iframe id="cif" style="display:none" allowfullscreen allow="autoplay; encrypted-media"></iframe>
          <div id="errp" style="display:none;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:12px;background:#0d0d0d;padding:20px;text-align:center"></div>
        </div>
        <div class="mvbox" id="mvb"></div>
        <div class="pinfo" id="pinfo" style="display:none">
          <div style="min-width:0;flex:1">
            <div class="ptitle" id="ptitle"></div>
            <div class="psub" id="psub"></div>
          </div>
          <div class="pacts">
            <button class="btn btn-g btn-sm" id="favbtn" onclick="toggleFavCurr()">â˜†</button>
            <button class="btn btn-g btn-sm" onclick="openMvAdd()">âŠ ë©€í‹°ë·°</button>
            <div class="tbadge" id="tbadge"></div>
          </div>
        </div>
      </div>

      <div class="epgwrap" id="epgw" style="display:none">
        <div class="epgstrip" id="epgs"></div>
      </div>

      <div class="rcwrap" id="rcw" style="display:none">
        <div class="rclabel">ğŸ• ìµœê·¼ ë³¸ ì±„ë„</div>
        <div class="rclist" id="rcl"></div>
      </div>

      <div class="hint" id="hint">
        ğŸ’¡ <strong>ì†ŒìŠ¤ê²€ìƒ‰</strong>ì—ì„œ ë¬´ë£Œ ê³µê°œì†ŒìŠ¤ë¥¼ ì°¾ê±°ë‚˜, <strong>ï¼‹ ì¶”ê°€</strong>ë¡œ ì§ì ‘ ì±„ë„ì„ ì¶”ê°€í•˜ì„¸ìš”.
      </div>

      <div class="sbar"><span style="color:var(--text2);font-size:13px">ğŸ”</span><input type="text" id="csearch" placeholder="ì±„ë„ ê²€ìƒ‰..." oninput="renderGrid()"></div>

      <div class="ghdr">
        <div class="gtitle">ğŸ“¡ ë‚´ ë°©ì†¡êµ­</div>
        <div style="font-size:11px;color:var(--text2)" id="ccount"></div>
      </div>
      <div class="cgrid" id="cgrid"></div>
    </div>
  </main>
</div>

<!-- â•â•â• ì±„ë„ ì¶”ê°€ ëª¨ë‹¬ â•â•â• -->
<div class="overlay" id="m-addch">
  <div class="modal">
    <div class="mhead"><div class="mtitle">ì±„ë„ ì¶”ê°€</div><button class="mclose" onclick="closeM('addch')">âœ•</button></div>
    <div class="ttabs">
      <button class="ttab on youtube" onclick="setType('youtube',this)">â–¶ YouTube</button>
      <button class="ttab m3u" onclick="setType('m3u',this)">ğŸ“¡ HLS/M3U</button>
      <button class="ttab custom" onclick="setType('custom',this)">ğŸ”— ì»¤ìŠ¤í…€</button>
      <button class="ttab file" onclick="setType('file',this)">ğŸ“‚ M3U íŒŒì¼</button>
    </div>
    <div id="filesec" style="display:none">
      <div class="dz" id="dz" onclick="document.getElementById('m3ufile').click()">
        <div class="dz-icon">ğŸ“‚</div>
        <div style="font-size:12px">M3U íŒŒì¼ì„ ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì„¸ìš”</div>
        <div style="font-size:10px;opacity:.6;margin-top:3px">.m3u / .m3u8 ì§€ì›</div>
      </div>
      <input type="file" id="m3ufile" accept=".m3u,.m3u8" style="display:none" onchange="handleM3U(this.files[0])">
      <div id="m3ures" style="display:none">
        <div style="font-size:13px;margin-bottom:9px"><span id="m3ucnt" style="color:var(--live);font-weight:700"></span>ê°œ ì±„ë„ ë°œê²¬</div>
        <div class="fg"><label>ì¹´í…Œê³ ë¦¬ (ì„ íƒ)</label><input type="text" id="m3ucat" placeholder="ì˜ˆ: IPTV, í•´ì™¸ë‰´ìŠ¤"></div>
        <div id="m3uprev" style="max-height:150px;overflow-y:auto;background:var(--surface2);border-radius:7px;padding:7px;margin-bottom:9px;font-size:11px;"></div>
        <button class="btn btn-p" style="width:100%" onclick="importM3U()">ëª¨ë‘ ì¶”ê°€</button>
      </div>
    </div>
    <div id="normsec">
      <div class="fg"><label>ì±„ë„ ì´ë¦„</label><input type="text" id="aname" placeholder="ì˜ˆ: BBC World News"></div>
      <div class="fg"><label id="aurlL">YouTube URL</label><input type="text" id="aurl" placeholder="https://www.youtube.com/watch?v=..."></div>
      <div class="fg">
        <label>ì¹´í…Œê³ ë¦¬ (ì„ íƒ)</label>
        <input type="text" id="acat" placeholder="ë‰´ìŠ¤, ìŠ¤í¬ì¸ , ì˜í™”...">
        <div id="catsugg" style="display:flex;gap:4px;flex-wrap:wrap;margin-top:5px"></div>
      </div>
      <div id="thint" style="font-size:11px;color:var(--text2);background:var(--surface2);padding:8px 11px;border-radius:7px;margin-bottom:4px;line-height:1.7"></div>
      <div class="mfoot"><button class="btn btn-g" onclick="closeM('addch')">ì·¨ì†Œ</button><button class="btn btn-p" onclick="addCh()">ì¶”ê°€</button></div>
    </div>
  </div>
</div>

<!-- â•â•â• ì „ì²´ ì¶”ê°€ëœ ìŠ¤íŠ¸ë¦¬ë° ì£¼ì†Œ ëª¨ë‹¬ â•â•â• -->
<div class="overlay" id="m-allsrc">
  <div class="modal" style="max-width:560px">
    <div class="mhead"><div class="mtitle">ğŸ“‹ ì „ì²´ ì¶”ê°€ëœ ìŠ¤íŠ¸ë¦¬ë° ì£¼ì†Œ</div><button class="mclose" onclick="closeM('allsrc')">âœ•</button></div>
    <div style="font-size:12px;color:var(--text2);margin-bottom:12px">ë‚´ê°€ ì¶”ê°€í•œ ëª¨ë“  ìŠ¤íŠ¸ë¦¬ë° ì£¼ì†Œì…ë‹ˆë‹¤. â–¶ ì¬ìƒ í…ŒìŠ¤íŠ¸, ï¼‹ ë‚´ì±„ë„ ì¶”ê°€, ğŸ—‘ ì‚­ì œ.</div>
    <div class="sbar" style="margin:0 0 10px"><span style="color:var(--text2);font-size:13px">ğŸ”</span><input type="text" id="asearch" placeholder="URL ë˜ëŠ” ì±„ë„ëª… ê²€ìƒ‰..." oninput="renderAllSrc()"></div>
    <div id="aslist" style="max-height:420px;overflow-y:auto;border:1px solid var(--border);border-radius:9px;"></div>
    <div class="mfoot"><button class="btn btn-g" onclick="closeM('allsrc')">ë‹«ê¸°</button></div>
  </div>
</div>

<!-- â•â•â• ì†ŒìŠ¤ ê²€ìƒ‰ ëª¨ë‹¬ â•â•â• -->
<div class="overlay" id="m-srcsearch">
  <div class="modal" style="max-width:560px">
    <div class="mhead"><div class="mtitle">ğŸ” ë¬´ë£Œ ê³µê°œ ì†ŒìŠ¤</div><button class="mclose" onclick="closeM('srcsearch')">âœ•</button></div>
    <div style="font-size:12px;color:var(--text2);margin-bottom:12px;line-height:1.7">ê²€ì¦ëœ ë¬´ë£Œ ê³µê°œ ì†ŒìŠ¤ ëª©ë¡ì…ë‹ˆë‹¤. â–¶ ì¬ìƒ í…ŒìŠ¤íŠ¸, ï¼‹ ë‚´ì±„ë„ ì €ì¥, ğŸ—‘ ì´ ëª©ë¡ì—ì„œ ì‚­ì œ.</div>
    <button class="btn btn-g" style="width:100%;margin-bottom:11px;justify-content:center;border-style:dashed" onclick="aiSearch()">âœ¨ ë¬´ë£Œ ê³µê°œì†ŒìŠ¤ ì¶”ê°€ ê²€ìƒ‰í•˜ê¸° (AI ì¶”ì²œ)</button>
    <div id="aiload" style="display:none;text-align:center;padding:18px;color:var(--text2);font-size:12px">
      <div style="width:26px;height:26px;border:2px solid var(--accent);border-top-color:transparent;border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 8px"></div>AIê°€ ì†ŒìŠ¤ë¥¼ íƒìƒ‰ ì¤‘...
    </div>
    <div id="airesd" style="display:none;margin-bottom:11px">
      <div class="slabel" style="padding-top:0">âœ¨ AI ì¶”ì²œ ì‹ ê·œ ì†ŒìŠ¤</div>
      <div id="aireslist" style="display:flex;flex-direction:column;gap:6px"></div>
    </div>
    <div id="publist" style="max-height:380px;overflow-y:auto;display:flex;flex-direction:column;gap:6px"></div>
    <div class="mfoot"><button class="btn btn-g" onclick="closeM('srcsearch')">ë‹«ê¸°</button></div>
  </div>
</div>

<!-- â•â•â• ë©€í‹°ë·° ëª¨ë‹¬ â•â•â• -->
<div class="overlay" id="m-mv">
  <div class="modal">
    <div class="mhead"><div class="mtitle">âŠ ë©€í‹°ë·° ì„¤ì •</div><button class="mclose" onclick="closeM('mv')">âœ•</button></div>
    <div style="display:flex;gap:6px;margin-bottom:13px">
      <button class="btn btn-g btn-sm" onclick="setMVL(1)">â–  1í™”ë©´</button>
      <button class="btn btn-g btn-sm" id="mvb2" onclick="setMVL(2)">âŠŸ 2ë¶„í• </button>
      <button class="btn btn-g btn-sm" onclick="setMVL(4)">âŠ 4ë¶„í• </button>
    </div>
    <div id="mvslots" style="display:flex;flex-direction:column;gap:7px;max-height:280px;overflow-y:auto"></div>
    <div class="mfoot">
      <button class="btn btn-g" onclick="stopMV()">ì¢…ë£Œ</button>
      <button class="btn btn-p" onclick="applyMV()">ì ìš©</button>
    </div>
  </div>
</div>

<script>
// â”€â”€ STATE â”€â”€
let chs   = JSON.parse(localStorage.getItem('hps_chs')    || '[]');
let favs  = JSON.parse(localStorage.getItem('hps_favs')   || '[]');
let recs  = JSON.parse(localStorage.getItem('hps_recs')   || '[]');
let pubs  = JSON.parse(localStorage.getItem('hps_pubs')   || 'null') || defPubs();
let curType='youtube', activeId=null, curCh=null, activeCat='all';
let curHls=null, isMV=false, mvLayout=2, mvSlots=[], pendSlots=[null,null];

// â”€â”€ DEFAULT PUBLIC SOURCES â”€â”€
function defPubs(){return[
  {id:'yt1',name:'NASA TV Live',url:'https://www.youtube.com/watch?v=21X5lGlDOfg',type:'youtube',badge:'ğŸš€',cat:'ê³¼í•™',desc:'NASA ê³µì‹ YouTube ë¼ì´ë¸Œ'},
  {id:'yt2',name:'Al Jazeera English',url:'https://www.youtube.com/watch?v=F-PDSKy4R0I',type:'youtube',badge:'ğŸŒ',cat:'ë‰´ìŠ¤',desc:'ì•Œìì§€ë¼ ì˜ë¬¸ ë¼ì´ë¸Œ'},
  {id:'yt3',name:'DW News',url:'https://www.youtube.com/watch?v=zCkiqVbxN20',type:'youtube',badge:'ğŸ‡©ğŸ‡ª',cat:'ë‰´ìŠ¤',desc:'Deutsche Welle ì˜ë¬¸ ë¼ì´ë¸Œ'},
  {id:'yt4',name:'NHK World',url:'https://www.youtube.com/watch?v=coYw-eVU0Ks',type:'youtube',badge:'ğŸ‡¯ğŸ‡µ',cat:'ë‰´ìŠ¤',desc:'NHK êµ­ì œë°©ì†¡ ë¼ì´ë¸Œ'},
  {id:'yt5',name:'Euronews',url:'https://www.youtube.com/watch?v=KovINkxHzYE',type:'youtube',badge:'ğŸ‡ªğŸ‡º',cat:'ë‰´ìŠ¤',desc:'ìœ ë¡œë‰´ìŠ¤ ì˜ë¬¸ ë¼ì´ë¸Œ'},
  {id:'yt6',name:'France 24 English',url:'https://www.youtube.com/watch?v=h3MuIUNCCzI',type:'youtube',badge:'ğŸ‡«ğŸ‡·',cat:'ë‰´ìŠ¤',desc:'í”„ë‘ìŠ¤24 ì˜ë¬¸ ë¼ì´ë¸Œ'},
  {id:'yt7',name:'Bloomberg TV',url:'https://www.youtube.com/watch?v=dp8PhLsUcFE',type:'youtube',badge:'ğŸ’¹',cat:'ê²½ì œ',desc:'ë¸”ë£¸ë²„ê·¸ ê²½ì œ ë¼ì´ë¸Œ'},
  {id:'yt8',name:'ABC News Australia',url:'https://www.youtube.com/watch?v=vOTiJkg1voo',type:'youtube',badge:'ğŸ¦˜',cat:'ë‰´ìŠ¤',desc:'í˜¸ì£¼ ABC ë‰´ìŠ¤ ë¼ì´ë¸Œ'},
  {id:'yt9',name:'CGTN',url:'https://www.youtube.com/watch?v=FBiMEqpN83U',type:'youtube',badge:'ğŸ‡¨ğŸ‡³',cat:'ë‰´ìŠ¤',desc:'ì¤‘êµ­ CGTN ì˜ë¬¸ ë¼ì´ë¸Œ'},
  {id:'yt10',name:'TRT World',url:'https://www.youtube.com/watch?v=QkjEI4MKBQA',type:'youtube',badge:'ğŸ‡¹ğŸ‡·',cat:'ë‰´ìŠ¤',desc:'í„°í‚¤ TRT World ë¼ì´ë¸Œ'},
  {id:'h1',name:'Big Buck Bunny (í…ŒìŠ¤íŠ¸)',url:'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',type:'m3u',badge:'ğŸ°',cat:'í…ŒìŠ¤íŠ¸',desc:'Mux ê³µê°œ HLS â€” ì•ˆì •ì ì¸ í…ŒìŠ¤íŠ¸ìš©'},
  {id:'h2',name:'Apple HLS Sample',url:'https://devstreaming-cdn.apple.com/videos/streaming/examples/img_bipbop_adv_example_fmp4/master.m3u8',type:'m3u',badge:'ğŸ',cat:'í…ŒìŠ¤íŠ¸',desc:'Apple ê³µì‹ HLS ìƒ˜í”Œ'},
  {id:'h3',name:'NASA TV HLS',url:'https://ntv1.akamaized.net/hls/live/2014075/NASA-NTV1-HLS/master.m3u8',type:'m3u',badge:'ğŸš€',cat:'ë‰´ìŠ¤',desc:'NASA TV HLS ë¼ì´ë¸Œ'},
  {id:'h4',name:'Al Jazeera HLS',url:'https://live-hls-web-aje.getaj.net/AJE/01.m3u8',type:'m3u',badge:'ğŸŒ',cat:'ë‰´ìŠ¤',desc:'Al Jazeera HLS ì§ì ‘ ì¬ìƒ'},
  {id:'h5',name:'DW News HLS',url:'https://dwamdstream102.akamaized.net/hls/live/2015525/dwstream102/index.m3u8',type:'m3u',badge:'ğŸ‡©ğŸ‡ª',cat:'ë‰´ìŠ¤',desc:'Deutsche Welle HLS'},
  {id:'h6',name:'France 24 HLS',url:'https://live.france24.com/hls/live/2037844/F24_EN_HI_HLS/master.m3u8',type:'m3u',badge:'ğŸ‡«ğŸ‡·',cat:'ë‰´ìŠ¤',desc:'France 24 HLS'},
  {id:'h7',name:'Euronews HLS',url:'https://euronews-euronews-ww-en-egress.rakuten.nv.akamaized.net/hls/live/2058930/euronewswwen/index.m3u8',type:'m3u',badge:'ğŸ‡ªğŸ‡º',cat:'ë‰´ìŠ¤',desc:'Euronews HLS'},
  {id:'h8',name:'Akamai Live Test',url:'https://cph-p2p-msl.akamaized.net/hls/live/2000341/test/master.m3u8',type:'m3u',badge:'ğŸ“¡',cat:'í…ŒìŠ¤íŠ¸',desc:'Akamai ê³µê°œ HLS í…ŒìŠ¤íŠ¸'},
];}

function savePubs(){localStorage.setItem('hps_pubs',JSON.stringify(pubs));}

// â”€â”€ MOBILE SIDEBAR â”€â”€
function openSB(){document.getElementById('sb').classList.add('open');document.getElementById('sbb').classList.add('open');}
function closeSB(){document.getElementById('sb').classList.remove('open');document.getElementById('sbb').classList.remove('open');}

// â”€â”€ MODAL â”€â”€
function openM(id){
  document.getElementById('m-'+id).classList.add('on');
  if(id==='allsrc') renderAllSrc();
  if(id==='srcsearch') renderPubList();
}
function closeM(id){document.getElementById('m-'+id).classList.remove('on');}
document.querySelectorAll('.overlay').forEach(el=>el.addEventListener('click',e=>{if(e.target===el) el.classList.remove('on');}));

// â”€â”€ SIDEBAR TABS â”€â”€
function switchTab(t){
  document.querySelectorAll('.stab').forEach((x,i)=>x.classList.toggle('on',['my','fav'][i]===t));
  document.querySelectorAll('.spanel').forEach(p=>p.classList.remove('on'));
  document.getElementById('p-'+t).classList.add('on');
}

// â”€â”€ CATEGORY â”€â”€
function allCats(){return[...new Set(chs.map(c=>c.cat).filter(Boolean))];}
function setCat(cat){
  activeCat=cat;
  document.querySelectorAll('.cat-chip').forEach(c=>c.classList.toggle('on',c.dataset.cat===cat));
  renderSB(); renderGrid();
}
function renderCatBar(){
  const cats=allCats();
  document.getElementById('catbar').innerHTML=
    `<div class="cat-chip on" data-cat="all" onclick="setCat('all')">ì „ì²´</div>`+
    cats.map(c=>`<div class="cat-chip ${activeCat===c?'on':''}" data-cat="${c}" onclick="setCat('${c}')">${c}</div>`).join('');
  const s=document.getElementById('catsugg');
  if(s) s.innerHTML=cats.map(c=>`<span onclick="document.getElementById('acat').value='${c}'" style="padding:2px 8px;background:var(--surface2);border:1px solid var(--border2);border-radius:10px;font-size:10px;cursor:pointer;color:var(--text2)">${c}</span>`).join('');
}

// â”€â”€ TYPE TABS â”€â”€
const HINTS={youtube:'YouTube embed í—ˆìš© URL. í•œêµ­ ì£¼ìš” ë°©ì†¡ì‚¬ ë¼ì´ë¸ŒëŠ” í¼ê°€ê¸° ê¸ˆì§€ë¡œ ì¬ìƒ ë¶ˆê°€.',m3u:'M3U8/HLS ì§ì ‘ ì¬ìƒ URL.',custom:'iframe ì„ë² ë“œ ê°€ëŠ¥í•œ URL.',file:'M3U íŒŒì¼ì„ ë¶ˆëŸ¬ì™€ ì±„ë„ ì¼ê´„ ì¶”ê°€.'};
const PHOLDS={youtube:'https://www.youtube.com/watch?v=...',m3u:'https://example.com/stream.m3u8',custom:'https://example.com/embed/...'};
function setType(t,btn){
  curType=t;
  document.querySelectorAll('.ttab').forEach(x=>x.classList.remove('on','youtube','m3u','custom','file'));
  btn.classList.add('on',t);
  const isF=t==='file';
  document.getElementById('filesec').style.display=isF?'block':'none';
  document.getElementById('normsec').style.display=isF?'none':'block';
  if(!isF){document.getElementById('thint').textContent=HINTS[t];document.getElementById('aurl').placeholder=PHOLDS[t]||'';document.getElementById('aurlL').textContent={youtube:'YouTube URL',m3u:'HLS/M3U URL',custom:'ìŠ¤íŠ¸ë¦¼ URL'}[t];}
}

// â”€â”€ M3U â”€â”€
let parsedChs=[];
function handleM3U(f){
  if(!f) return;
  const r=new FileReader();
  r.onload=e=>{
    parsedChs=parseM3U(e.target.result);
    document.getElementById('m3ucnt').textContent=parsedChs.length;
    document.getElementById('m3uprev').innerHTML=parsedChs.slice(0,12).map(c=>`<div style="padding:3px 0;border-bottom:1px solid var(--border);display:flex;gap:5px"><span style="color:var(--m3u)">ğŸ“¡</span><span style="flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${c.name}</span><span style="color:var(--text2);font-size:10px">${c.group||''}</span></div>`).join('')+(parsedChs.length>12?`<div style="padding:4px;text-align:center;font-size:10px;color:var(--text2)">...ì™¸ ${parsedChs.length-12}ê°œ</div>`:'');
    document.getElementById('m3ures').style.display='block';
    toast(`âœ… ${parsedChs.length}ê°œ ì±„ë„ ë°œê²¬`,'s');
  };
  r.readAsText(f);
}
function parseM3U(txt){
  const lines=txt.split('\n').map(l=>l.trim()).filter(Boolean),res=[];let cur=null;
  for(const l of lines){
    if(l.startsWith('#EXTINF')){cur={name:l.match(/,(.+)$/)?.[1]?.trim()||'ì•Œìˆ˜ì—†ìŒ',group:l.match(/group-title="([^"]+)"/)?.[1]||'',type:'m3u'};}
    else if(l&&!l.startsWith('#')&&cur){cur.url=l;res.push(cur);cur=null;}
  }
  return res;
}
function importM3U(){
  const cat=document.getElementById('m3ucat').value.trim();let added=0;
  parsedChs.forEach(c=>{
    if(chs.find(x=>x.url===c.url)) return;
    chs.push({id:Date.now()+Math.random(),name:c.name,url:c.url,type:'m3u',cat:cat||c.group||'',added:new Date().toLocaleDateString('ko-KR')});added++;
  });
  save();renderAll();closeM('addch');toast(`âœ… ${added}ê°œ ì¶”ê°€ ì™„ë£Œ`,'s');
}
const dz=document.getElementById('dz');
dz.addEventListener('dragover',e=>{e.preventDefault();dz.classList.add('dzo');});
dz.addEventListener('dragleave',()=>dz.classList.remove('dzo'));
dz.addEventListener('drop',e=>{e.preventDefault();dz.classList.remove('dzo');handleM3U(e.dataTransfer.files[0]);});

// â”€â”€ ADD / REMOVE â”€â”€
function addCh(){
  const nm=document.getElementById('aname').value.trim(),url=document.getElementById('aurl').value.trim(),cat=document.getElementById('acat').value.trim();
  if(!nm||!url){toast('âŒ ì´ë¦„ê³¼ URLì„ ì…ë ¥í•˜ì„¸ìš”','e');return;}
  if(chs.find(c=>c.url===url)){toast('ì´ë¯¸ ì¶”ê°€ëœ ì±„ë„ì…ë‹ˆë‹¤','e');return;}
  chs.push({id:Date.now(),name:nm,url,type:curType,cat,added:new Date().toLocaleDateString('ko-KR')});
  save();renderAll();closeM('addch');
  document.getElementById('aname').value='';document.getElementById('aurl').value='';document.getElementById('acat').value='';
  toast(`âœ… "${nm}" ì¶”ê°€ë¨`,'s');
}
function removeCh(id,e){
  if(e&&e.stopPropagation) e.stopPropagation();
  chs=chs.filter(c=>c.id!==id);favs=favs.filter(f=>f!==id);recs=recs.filter(r=>r!==id);
  if(activeId===id){activeId=null;curCh=null;stopPlayer();}
  save();renderAll();toast('ì‚­ì œë¨');
}

// â”€â”€ FAVS â”€â”€
function toggleFav(id){favs.includes(id)?favs=favs.filter(f=>f!==id):favs.push(id);save();renderAll();updateFavBtn();}
function toggleFavCurr(){if(activeId) toggleFav(activeId);}
function updateFavBtn(){
  const btn=document.getElementById('favbtn');if(!btn||!activeId) return;
  const on=favs.includes(activeId);
  btn.textContent=on?'â˜…':'â˜†';btn.style.color=on?'var(--fav)':'';btn.style.borderColor=on?'rgba(245,158,11,.4)':'';
}

// â”€â”€ RECENT â”€â”€
function addRec(id){recs=[id,...recs.filter(r=>r!==id)].slice(0,8);localStorage.setItem('hps_recs',JSON.stringify(recs));}
function renderRecent(){
  const valid=recs.map(id=>chs.find(c=>c.id===id)).filter(Boolean);
  const w=document.getElementById('rcw');
  if(!valid.length){w.style.display='none';return;}
  w.style.display='block';
  document.getElementById('rcl').innerHTML=valid.map(c=>`<div class="rcchip" onclick='play(${sj(c)})'>${c.type==='youtube'?'â–¶':c.type==='m3u'?'ğŸ“¡':'ğŸ”—'} ${c.name}</div>`).join('');
}

// â”€â”€ SAVE â”€â”€
function save(){localStorage.setItem('hps_chs',JSON.stringify(chs));localStorage.setItem('hps_favs',JSON.stringify(favs));}

// â”€â”€ PLAYER â”€â”€
function resetPlayer(){
  // 1) HLS ì™„ì „ ì •ì§€
  if(curHls){try{curHls.destroy();}catch(e){}curHls=null;}
  const v=document.getElementById('hlsv');
  try{v.pause();}catch(e){}
  v.removeAttribute('src');
  try{v.load();}catch(e){}
  v.style.display='none';

  // 2) YouTube iframe: postMessageë¡œ ë¨¼ì € ì •ì§€ â†’ ê·¸ ë‹¤ìŒ DOM ì œê±°
  const yt=document.getElementById('ytp');
  const ytIframe=yt.querySelector('iframe');
  if(ytIframe){
    try{
      ytIframe.contentWindow.postMessage(
        JSON.stringify({event:'command',func:'stopVideo',args:[]}),
        '*'
      );
    }catch(e){}
    // ì¦‰ì‹œ srcë¥¼ blankë¡œ ë°”ê¿” ì˜¤ë””ì˜¤ ì¦‰ì‹œ ì°¨ë‹¨
    try{ytIframe.src='about:blank';}catch(e){}
  }
  yt.innerHTML='';
  yt.style.display='none';

  // 3) custom iframe
  const cf=document.getElementById('cif');
  try{cf.src='about:blank';}catch(e){}
  cf.style.display='none';

  // 4) ì—ëŸ¬ íŒ¨ë„ ìˆ¨ê¹€
  const ep=document.getElementById('errp');
  if(ep){ep.style.display='none';ep.innerHTML='';}

  document.getElementById('pph').style.display='none';
}
function stopPlayer(){
  resetPlayer();document.getElementById('pph').style.display='flex';
  document.getElementById('pinfo').style.display='none';document.getElementById('epgw').style.display='none';
}
function play(ch){
  if(isMV){addToMvSlot(ch);return;}
  activeId=ch.id;curCh=ch;resetPlayer();
  if(ch.type==='youtube'){const vid=ytId(ch.url);if(!vid){showErr(ch,'ìœ íš¨í•œ YouTube URLì´ ì•„ë‹™ë‹ˆë‹¤.');return;}playYT(vid);}
  else if(ch.type==='m3u'){playHLS(ch);}
  else{const cf=document.getElementById('cif');cf.src=ch.url;cf.style.display='block';}
  document.getElementById('pinfo').style.display='flex';
  document.getElementById('ptitle').textContent=ch.name;
  document.getElementById('psub').textContent=ch.cat?`${ch.cat} Â· ${ch.type.toUpperCase()}`:ch.type.toUpperCase();
  const tb=document.getElementById('tbadge');
  tb.textContent={youtube:'YouTube',m3u:'HLS',custom:'Custom'}[ch.type]||ch.type;tb.className='tbadge '+ch.type;
  if(ch.id&&ch.id!=='__preview__') addRec(ch.id);
  updateFavBtn();renderSB();renderGrid();renderRecent();showEPG();
  if(window.innerWidth<=768) closeSB();
}
function playYT(vid){
  const el=document.getElementById('ytp');el.style.display='block';
  const origin=location.origin!=='null'?location.origin:'https://hps.local';
  el.innerHTML=`<iframe src="https://www.youtube-nocookie.com/embed/${vid}?autoplay=1&rel=0&enablejsapi=1&origin=${encodeURIComponent(origin)}" style="width:100%;height:100%;border:none;display:block" title="YouTube player" allowfullscreen allow="accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture;web-share" referrerpolicy="strict-origin-when-cross-origin"></iframe>`;
}
// â”€â”€ í”„ë¡ì‹œ ì„¤ì • â”€â”€
let userProxy = localStorage.getItem('hps_proxy') || '';

function getProxyUrl(url) {
  if (url.startsWith('https://')) return url;  // HTTPSëŠ” í”„ë¡ì‹œ ë¶ˆí•„ìš”
  if (userProxy) return userProxy + '/?url=' + encodeURIComponent(url);
  return url;  // í”„ë¡ì‹œ ì—†ìœ¼ë©´ ê·¸ëŒ€ë¡œ (localhostìš©)
}

// í”„ë¡ì‹œ ëª¨ë‹¬ ì—´ê¸°
function openProxyModal() {
  document.getElementById('proxyInput').value = userProxy;
  updateProxyStatus();
  openM('proxy');
}

// ì €ì¥
function saveProxy() {
  const val = document.getElementById('proxyInput').value.trim().replace(/\/+$/, '');
  userProxy = val;
  if (val) {
    localStorage.setItem('hps_proxy', val);
  } else {
    localStorage.removeItem('hps_proxy');
  }
  updateProxyBtn();
  updateProxyStatus();
  closeM('proxy');
  toast(val ? 'âœ… í”„ë¡ì‹œ ì €ì¥ë¨' : 'í”„ë¡ì‹œê°€ ì‚­ì œëìŠµë‹ˆë‹¤', val ? 's' : '');
}

// ì‚­ì œ
function clearProxy() {
  userProxy = '';
  localStorage.removeItem('hps_proxy');
  document.getElementById('proxyInput').value = '';
  document.getElementById('proxyTestResult').style.display = 'none';
  updateProxyBtn();
  updateProxyStatus();
  toast('ğŸ—‘ í”„ë¡ì‹œ ì‚­ì œë¨');
}

// í—¤ë” ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
function updateProxyBtn() {
  const btn = document.getElementById('proxybtn');
  if (!btn) return;
  if (userProxy) {
    btn.textContent = 'âš™ï¸ í”„ë¡ì‹œ ON';
    btn.style.borderColor = 'rgba(46,204,113,.5)';
    btn.style.color = 'var(--live)';
  } else {
    btn.textContent = 'âš™ï¸ í”„ë¡ì‹œ';
    btn.style.borderColor = '';
    btn.style.color = '';
  }
}

// ëª¨ë‹¬ ë‚´ ìƒíƒœ í‘œì‹œ ì—…ë°ì´íŠ¸
function updateProxyStatus() {
  const dot = document.getElementById('proxy-status-dot');
  const txt = document.getElementById('proxy-status-text');
  if (!dot || !txt) return;
  if (userProxy) {
    dot.style.background = 'var(--live)';
    txt.style.color = 'var(--live)';
    txt.textContent = 'âœ… í™œì„± â€” ' + userProxy;
  } else {
    dot.style.background = 'var(--accent)';
    txt.style.color = 'var(--text2)';
    txt.textContent = 'âš ï¸ ë¯¸ì„¤ì • â€” HTTP ìŠ¤íŠ¸ë¦¼ ì¬ìƒ ë¶ˆê°€';
  }
}

// ì—°ê²° í…ŒìŠ¤íŠ¸
async function testProxy() {
  const val = document.getElementById('proxyInput').value.trim().replace(/\/+$/, '');
  const res = document.getElementById('proxyTestResult');
  res.style.display = 'block';
  res.style.borderColor = 'var(--border2)';
  res.innerHTML = 'ğŸ”„ í…ŒìŠ¤íŠ¸ ì¤‘...';
  if (!val) {
    res.style.borderColor = 'rgba(192,57,43,.4)';
    res.innerHTML = 'âŒ URLì„ ë¨¼ì € ì…ë ¥í•˜ì„¸ìš”';
    return;
  }
  const testUrl = 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8';
  try {
    const resp = await fetch(val + '/?url=' + encodeURIComponent(testUrl), {
      signal: AbortSignal.timeout(7000)
    });
    if (resp.ok) {
      const text = await resp.text();
      if (text.includes('#EXTM3U') || text.includes('#EXT')) {
        res.style.borderColor = 'rgba(46,204,113,.4)';
        res.innerHTML = 'âœ… ì—°ê²° ì„±ê³µ! í”„ë¡ì‹œê°€ ì •ìƒ ë™ì‘í•©ë‹ˆë‹¤.<br><span style="color:var(--text3)">ì €ì¥ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì ìš©í•˜ì„¸ìš”.</span>';
      } else {
        res.style.borderColor = 'rgba(245,158,11,.4)';
        res.innerHTML = 'âš ï¸ ì‘ë‹µì€ ì™”ì§€ë§Œ m3u8 í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.<br>Worker ì½”ë“œê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸í•˜ì„¸ìš”.';
      }
    } else {
      res.style.borderColor = 'rgba(192,57,43,.4)';
      res.innerHTML = `âŒ HTTP ${resp.status} ì˜¤ë¥˜ â€” Worker URLì„ í™•ì¸í•˜ì„¸ìš”`;
    }
  } catch (e) {
    res.style.borderColor = 'rgba(192,57,43,.4)';
    res.innerHTML = 'âŒ ì—°ê²° ì‹¤íŒ¨: ' + e.message;
  }
}

function buildHls(proxyFn) {
  const CustomLoader = (function() {
    const Default = Hls.DefaultConfig.loader;
    function L(c) { Default.call(this, c); }
    L.prototype = Object.create(Default.prototype);
    L.prototype.constructor = L;
    L.prototype.load = function(ctx, cfg, cbs) {
      ctx.url = proxyFn(ctx.url);
      Default.prototype.load.call(this, ctx, cfg, cbs);
    };
    return L;
  })();
  return new Hls({
    enableWorker: true,
    lowLatencyMode: true,
    xhrSetup: function(xhr) { xhr.withCredentials = false; },
    pLoader: CustomLoader,
    fLoader: CustomLoader,
  });
}

function playHLS(ch) {
  const v = document.getElementById('hlsv');
  const ep = document.getElementById('errp');
  ep.style.display = 'none';
  v.style.display = 'block';

  // HTTP ìŠ¤íŠ¸ë¦¼ì¸ë° í”„ë¡ì‹œ ë¯¸ì„¤ì • â†’ ì•ˆë‚´
  if (ch.url.startsWith('http://') && !userProxy) {
    v.style.display = 'none';
    ep.style.display = 'flex';
    ep.innerHTML = `
      <div style="font-size:28px">âš ï¸</div>
      <div>
        <div style="font-size:13px;font-weight:700;margin-bottom:5px;color:var(--accent)">í”„ë¡ì‹œ ì„¤ì • í•„ìš”</div>
        <div style="font-size:11px;color:var(--text2);max-width:320px;line-height:1.9">
          ì´ ìŠ¤íŠ¸ë¦¼ì€ <strong style="color:var(--text)">HTTP</strong> ì£¼ì†Œì…ë‹ˆë‹¤.<br>
          GitHub Pages(HTTPS)ì—ì„œ HTTP ìŠ¤íŠ¸ë¦¼ì„ ì¬ìƒí•˜ë ¤ë©´<br>
          Cloudflare Worker í”„ë¡ì‹œ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.
        </div>
        <button onclick="openProxyModal()" style="margin-top:11px;padding:7px 14px;background:var(--accent);color:#fff;border:none;border-radius:7px;cursor:pointer;font-size:11px;font-family:inherit">
          âš™ï¸ í”„ë¡ì‹œ ì„¤ì •í•˜ê¸°
        </button>
        <a href="${ch.url}" target="_blank" style="display:inline-block;margin-top:8px;margin-left:6px;padding:7px 13px;background:var(--surface2);border:1px solid var(--border2);color:var(--text);border-radius:7px;text-decoration:none;font-size:11px">
          ğŸ”— ìƒˆ ì°½ì—ì„œ ì—´ê¸°
        </a>
      </div>`;
    return;
  }

  if (Hls.isSupported()) {
    if (curHls) { try { curHls.destroy(); } catch(e) {} curHls = null; }
    curHls = buildHls(url => getProxyUrl(url));
    curHls.loadSource(ch.url);
    curHls.attachMedia(v);
    curHls.on(Hls.Events.MANIFEST_PARSED, () => { v.play().catch(() => {}); });
    curHls.on(Hls.Events.ERROR, (ev, d) => {
      if (d.fatal) {
        curHls.destroy(); curHls = null;
        v.style.display = 'none';
        let msg = 'ìŠ¤íŠ¸ë¦¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>';
        if (d.type === Hls.ErrorTypes.NETWORK_ERROR) {
          msg += userProxy
            ? 'í”„ë¡ì‹œê°€ ì‘ë‹µí•˜ì§€ ì•Šê±°ë‚˜ ìŠ¤íŠ¸ë¦¼ ì„œë²„ê°€ ì°¨ë‹¨ëìŠµë‹ˆë‹¤.'
            : 'CORS ì •ì±…ìœ¼ë¡œ ì°¨ë‹¨ëìŠµë‹ˆë‹¤. í”„ë¡ì‹œ ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.';
        } else if (d.type === Hls.ErrorTypes.MEDIA_ERROR) {
          msg += 'ì§€ì›í•˜ì§€ ì•ŠëŠ” ì½”ë±ì´ê±°ë‚˜ ìŠ¤íŠ¸ë¦¼ì´ ì†ìƒëìŠµë‹ˆë‹¤.';
        } else {
          msg += 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜.';
        }
        showErr(ch, msg);
      }
    });
  } else if (v.canPlayType('application/vnd.apple.mpegurl')) {
    v.src = getProxyUrl(ch.url);
    v.play().catch(() => {});
  } else {
    showErr(ch, 'ì´ ë¸Œë¼ìš°ì €ëŠ” HLSë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
  }
}
function showErr(ch,msg){
  document.getElementById('ytp').style.display='none';
  document.getElementById('hlsv').style.display='none';
  const ep=document.getElementById('errp');
  ep.style.display='flex';
  ep.innerHTML=`<div style="font-size:30px">âš ï¸</div><div><div style="font-size:14px;font-weight:700;margin-bottom:5px;color:var(--accent)">${ch.name}</div><div style="font-size:11px;color:var(--text2);max-width:320px;line-height:1.8">${msg}</div><a href="${ch.url}" target="_blank" style="display:inline-block;margin-top:11px;padding:6px 13px;background:var(--surface2);border:1px solid var(--border2);color:var(--text);border-radius:7px;text-decoration:none;font-size:11px">ğŸ”— ì§ì ‘ ì—´ê¸°</a></div>`;
}

// â”€â”€ MULTIVIEW â”€â”€
function openMvAdd(){
  if(curCh){const i=pendSlots.findIndex(s=>!s);if(i>=0) pendSlots[i]=curCh;}
  openM('mv');renderMvSlots();
}
function setMVL(n){mvLayout=n;pendSlots=Array(n).fill(null);renderMvSlots();}
function renderMvSlots(){
  document.getElementById('mvslots').innerHTML=pendSlots.map((ch,i)=>`
    <div style="display:flex;align-items:center;gap:8px;padding:9px 10px;background:var(--surface2);border-radius:8px;border:1px solid ${ch?'var(--accent)':'var(--border)'}">
      <div style="font-size:17px;width:28px;text-align:center">${ch?(ch.type==='youtube'?'â–¶':'ğŸ“¡'):'â¬œ'}</div>
      <div style="flex:1;font-size:12px">${ch?ch.name:'<span style="color:var(--text2)">ë¹„ì–´ìˆìŒ</span>'}</div>
      ${ch?`<button onclick="pendSlots[${i}]=null;renderMvSlots()" style="background:none;border:none;color:var(--text2);cursor:pointer">âœ•</button>`:''}
      <select onchange="assignSlot(${i},this.value)" style="font-size:11px;padding:4px 7px;max-width:120px">
        <option value="">ì±„ë„ ì„ íƒ...</option>
        ${chs.map(c=>`<option value="${c.id}" ${ch&&ch.id===c.id?'selected':''}>${c.name}</option>`).join('')}
      </select>
    </div>`).join('');
}
function assignSlot(idx,id){pendSlots[idx]=chs.find(c=>String(c.id)===String(id))||null;renderMvSlots();}
function addToMvSlot(ch){const i=mvSlots.findIndex(s=>!s.ch);if(i>=0){mvSlots[i].ch=ch;loadMvCell(i,ch);}else toast('ëª¨ë“  ìŠ¬ë¡¯ì´ ì°¼ìŠµë‹ˆë‹¤');}
function applyMV(){
  if(!pendSlots.filter(Boolean).length){toast('âŒ ì±„ë„ì„ ìµœì†Œ 1ê°œ ì„ íƒí•˜ì„¸ìš”','e');return;}
  isMV=true;document.getElementById('pbox').style.display='none';
  const mv=document.getElementById('mvb');mv.className=`mvbox on ${mvLayout===4?'mv4':'mv2'}`;
  if(mvLayout===1){mv.style.gridTemplateColumns='1fr';mv.style.gridTemplateRows='1fr';}
  mv.innerHTML='';mvSlots=[];
  for(let i=0;i<mvLayout;i++){
    const cell=document.createElement('div');cell.className='mvc';
    const ch=pendSlots[i];
    if(ch) loadMvCell(i,ch,cell);
    else cell.innerHTML=`<div class="mvempty"><span>â¬œ</span><span>ë¹„ì–´ìˆìŒ</span></div>`;
    mv.appendChild(cell);mvSlots.push({ch,el:cell});
  }
  closeM('mv');document.getElementById('pinfo').style.display='none';
}
function loadMvCell(idx,ch,cellEl){
  const cell=cellEl||mvSlots[idx]?.el;if(!cell) return;
  const origin=location.origin!=='null'?location.origin:'https://hps.local';
  let m='';
  if(ch.type==='youtube'){const vid=ytId(ch.url);if(vid) m=`<iframe src="https://www.youtube-nocookie.com/embed/${vid}?autoplay=1&mute=1&rel=0&origin=${encodeURIComponent(origin)}" style="width:100%;height:100%;border:none" allowfullscreen allow="autoplay;encrypted-media" referrerpolicy="strict-origin-when-cross-origin"></iframe>`;}
  else if(ch.type==='m3u'){m=`<video id="mv${idx}" style="width:100%;height:100%;object-fit:contain" muted playsinline controls></video>`;}
  else{m=`<iframe src="${ch.url}" style="width:100%;height:100%;border:none" allowfullscreen allow="autoplay;encrypted-media"></iframe>`;}
  cell.innerHTML=m+`<div class="mvlabel"><span>${ch.name}</span><button onclick="clearMvCell(${idx})" style="background:none;border:none;color:#fff;cursor:pointer;font-size:10px">âœ•</button></div>`;
  if(ch.type==='m3u'){const v=document.getElementById(`mv${idx}`);if(v&&Hls.isSupported()){const h=buildHls(url=>getProxyUrl(url));h.loadSource(ch.url);h.attachMedia(v);h.on(Hls.Events.MANIFEST_PARSED,()=>v.play().catch(()=>{}));}}
}
function clearMvCell(idx){if(!mvSlots[idx]) return;mvSlots[idx].ch=null;mvSlots[idx].el.innerHTML=`<div class="mvempty"><span>â¬œ</span><span>ë¹„ì–´ìˆìŒ</span></div>`;}
function stopMV(){
  isMV=false;const mv=document.getElementById('mvb');mv.classList.remove('on');mv.innerHTML='';mvSlots=[];
  document.getElementById('pbox').style.display='block';document.getElementById('pph').style.display='flex';
  activeId=null;curCh=null;closeM('mv');renderSB();renderGrid();
}

// â”€â”€ YOUTUBE ID â”€â”€
function ytId(url){
  if(!url) return null;
  const pats=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/live\/|youtube\.com\/shorts\/)([A-Za-z0-9_-]{11})/,/[?&]v=([A-Za-z0-9_-]{11})/,/^([A-Za-z0-9_-]{11})$/];
  for(const p of pats){const m=url.match(p);if(m) return m[1];}
  return null;
}

// â”€â”€ EPG â”€â”€
function showEPG(){
  const shows=['ë‰´ìŠ¤','ìŠ¤í¬ì¸ ','ì˜í™”','ë‹¤í','í† í¬ì‡¼','ìŒì•…','ë“œë¼ë§ˆ','ì˜ˆëŠ¥'];
  const now=new Date();let html='<div style="font-size:10px;color:var(--text2);white-space:nowrap;font-weight:700;flex-shrink:0">ğŸ“… í¸ì„± (ìƒ˜í”Œ)</div>';
  for(let i=-1;i<4;i++){
    const t=new Date(now.getTime()+i*3600000);
    const h=t.getHours().toString().padStart(2,'0'),m=Math.round(t.getMinutes()/30)*30;
    html+=`<div class="epgi ${i===0?'now':''}"><div class="epgt">${h}:${m===0?'00':'30'}</div><div class="epgs">${shows[Math.floor(Math.random()*shows.length)]}</div></div>`;
  }
  document.getElementById('epgw').style.display='block';document.getElementById('epgs').innerHTML=html;
}

// â”€â”€ ì „ì²´ ì†ŒìŠ¤ â”€â”€
function renderAllSrc(){
  const q=(document.getElementById('asearch').value||'').toLowerCase();
  const el=document.getElementById('aslist');
  const list=chs.filter(c=>!q||c.name.toLowerCase().includes(q)||c.url.toLowerCase().includes(q));
  if(!list.length){el.innerHTML='<div style="padding:20px;text-align:center;color:var(--text2);font-size:12px">ì¶”ê°€ëœ ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤</div>';return;}
  el.innerHTML=list.map(c=>`<div class="asi">
    <span style="font-size:14px;flex-shrink:0">${c.type==='youtube'?'â–¶':c.type==='m3u'?'ğŸ“¡':'ğŸ”—'}</span>
    <div style="flex:1;min-width:0">
      <div style="font-size:12px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${c.name}</div>
      <div class="asiurl">${c.url}</div>
    </div>
    <div style="display:flex;gap:4px;flex-shrink:0">
      <button class="btn btn-g btn-sm" onclick='play(${sj(c)});closeM("allsrc")'>â–¶</button>
      <button class="ich" onclick="removeCh(${c.id},event);renderAllSrc()" style="font-size:15px">ğŸ—‘</button>
    </div>
  </div>`).join('');
}

// â”€â”€ ì†ŒìŠ¤ ê²€ìƒ‰ ëª¨ë‹¬ â”€â”€
function renderPubList(){
  const el=document.getElementById('publist');
  const yt=pubs.filter(s=>s.type==='youtube'),hls=pubs.filter(s=>s.type==='m3u');
  let html='';
  if(yt.length){html+=`<div class="slabel" style="padding-top:0">â–¶ YouTube (embed í—ˆìš©)</div>`+yt.map(pubItem).join('');}
  if(hls.length){html+=`<div class="slabel">ğŸ“¡ HLS ì§ì ‘ ì¬ìƒ</div>`+hls.map(pubItem).join('');}
  el.innerHTML=html||'<div style="text-align:center;padding:20px;color:var(--text2);font-size:12px">ì†ŒìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
}
function pubItem(s){
  const added=!!chs.find(c=>c.url===s.url);
  return `<div class="srci">
    <div class="srcico ${s.type==='youtube'?'yt':'hls'}">${s.badge}</div>
    <div class="srcinf"><div class="srcnm">${s.name}</div><div class="srcdsc">${s.desc}</div></div>
    <div class="srcact">
      <button class="btn btn-g btn-sm" onclick='quickPlay(${sj(s)});closeM("srcsearch")'>â–¶</button>
      <button class="btn ${added?'btn-g':'btn-p'} btn-sm" onclick='quickAdd(${sj(s)})'>${added?'âœ“':'ï¼‹'}</button>
      <button class="ich" onclick='removePub("${s.id}")' style="font-size:15px">ğŸ—‘</button>
    </div>
  </div>`;
}
function removePub(id){pubs=pubs.filter(s=>s.id!==id);savePubs();renderPubList();toast('ì†ŒìŠ¤ ì‚­ì œë¨');}
function quickAdd(s){
  if(chs.find(c=>c.url===s.url)){toast('ì´ë¯¸ ì¶”ê°€ë¨');return;}
  chs.push({id:Date.now(),name:s.name,url:s.url,type:s.type,cat:s.cat||'',added:new Date().toLocaleDateString('ko-KR')});
  save();renderAll();renderPubList();toast(`âœ… "${s.name}" ì €ì¥ë¨`,'s');
}
function quickPlay(s){const ch={id:'__preview__',name:s.name,url:s.url,type:s.type};activeId='__preview__';curCh=ch;play(ch);}

// â”€â”€ AI ì¶”ê°€ ê²€ìƒ‰ â”€â”€
const aiPool=[
  {id:'ai1',name:'BBC World News',url:'https://www.youtube.com/watch?v=w_Ma8oQLmSM',type:'youtube',badge:'ğŸ‡¬ğŸ‡§',cat:'ë‰´ìŠ¤',desc:'BBC ì›”ë“œë‰´ìŠ¤ YouTube ë¼ì´ë¸Œ'},
  {id:'ai2',name:'Sky News',url:'https://www.youtube.com/watch?v=9Auq9mYxFEE',type:'youtube',badge:'ğŸŒ¤',cat:'ë‰´ìŠ¤',desc:'Sky News ì˜êµ­ ë¼ì´ë¸Œ'},
  {id:'ai3',name:'i24 NEWS English',url:'https://www.youtube.com/watch?v=gCNeDWCI0vo',type:'youtube',badge:'ğŸ‡®ğŸ‡±',cat:'ë‰´ìŠ¤',desc:'i24 ì¤‘ë™ êµ­ì œë‰´ìŠ¤'},
  {id:'ai4',name:'WION World News',url:'https://www.youtube.com/watch?v=oKxx5B30YJQ',type:'youtube',badge:'ğŸŒ',cat:'ë‰´ìŠ¤',desc:'ì¸ë„ WION êµ­ì œë‰´ìŠ¤'},
  {id:'ai5',name:'CNA Singapore',url:'https://www.youtube.com/watch?v=6OTWL4MmAFQ',type:'youtube',badge:'ğŸ‡¸ğŸ‡¬',cat:'ë‰´ìŠ¤',desc:'ì‹±ê°€í¬ë¥´ CNA ë¼ì´ë¸Œ'},
  {id:'ai6',name:'Arirang TV',url:'https://www.youtube.com/watch?v=h3bIcDZPJAU',type:'youtube',badge:'ğŸ‡°ğŸ‡·',cat:'í•œêµ­',desc:'ì•„ë¦¬ë‘ êµ­ì œë°©ì†¡ (embed í—ˆìš©)'},
  {id:'ai7',name:'RFI English',url:'https://www.youtube.com/watch?v=RoEmcXFDUW4',type:'youtube',badge:'ğŸ“»',cat:'ë‰´ìŠ¤',desc:'Radio France Int. ë¼ì´ë¸Œ'},
  {id:'ai8',name:'VOA News',url:'https://www.youtube.com/watch?v=Jqj-JhCrWJg',type:'youtube',badge:'ğŸ—½',cat:'ë‰´ìŠ¤',desc:'ë¯¸êµ­ì˜ ì†Œë¦¬ YouTube ë¼ì´ë¸Œ'},
  {id:'ai9',name:'KBS World Radio',url:'https://www.youtube.com/watch?v=la4pHgMzFao',type:'youtube',badge:'ğŸ“»',cat:'í•œêµ­',desc:'KBS ì›”ë“œ ë¼ì´ë¸Œ'},
  {id:'ai10',name:'Bloomberg HLS',url:'https://liveproduseast.akamaized.net/us/Channel-BloombergTV-US-Prod/output/index.m3u8',type:'m3u',badge:'ğŸ’¹',cat:'ê²½ì œ',desc:'Bloomberg TV HLS ë¼ì´ë¸Œ'},
  {id:'ai11',name:'Tears of Steel HLS',url:'https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8',type:'m3u',badge:'ğŸ¬',cat:'í…ŒìŠ¤íŠ¸',desc:'Unified Streaming HLS ë°ëª¨'},
  {id:'ai12',name:'RT International',url:'https://www.youtube.com/watch?v=AkfdADQlTDM',type:'youtube',badge:'ğŸ‡·ğŸ‡º',cat:'ë‰´ìŠ¤',desc:'RT êµ­ì œ ë‰´ìŠ¤ ë¼ì´ë¸Œ'},
];
let aiDone=[];

async function aiSearch(){
  const existing=[...pubs,...aiDone].map(s=>s.id);
  const cands=aiPool.filter(s=>!existing.includes(s.id)&&!chs.find(c=>c.url===s.url));
  if(!cands.length){toast('ë” ì´ìƒ ì¶”ì²œí•  ì‹ ê·œ ì†ŒìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤');return;}
  document.getElementById('aiload').style.display='block';document.getElementById('airesd').style.display='none';
  await new Promise(r=>setTimeout(r,1100));
  document.getElementById('aiload').style.display='none';
  const picks=cands.slice(0,4);aiDone=[...aiDone,...picks];
  document.getElementById('aireslist').innerHTML=picks.map(s=>`
    <div class="aiitem">
      <div class="srcico ${s.type==='youtube'?'yt':'hls'}" style="width:32px;height:32px;border-radius:7px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0">${s.badge}</div>
      <div class="srcinf" style="flex:1;min-width:0">
        <div style="display:flex;align-items:center;gap:5px;margin-bottom:2px"><span class="srcnm">${s.name}</span><span class="aibadge">AIì¶”ì²œ</span></div>
        <div class="srcdsc">${s.desc}</div>
      </div>
      <div class="srcact">
        <button class="btn btn-g btn-sm" onclick='quickPlay(${sj(s)});closeM("srcsearch")'>â–¶</button>
        <button class="btn btn-p btn-sm" onclick='addAiSrc(${sj(s)})'>ï¼‹ì €ì¥</button>
      </div>
    </div>`).join('');
  document.getElementById('airesd').style.display='block';
  toast(`âœ¨ ${picks.length}ê°œ ì‹ ê·œ ì†ŒìŠ¤ ì¶”ì²œ`,'s');
}

function addAiSrc(s){
  if(!pubs.find(p=>p.id===s.id)){pubs.push(s);savePubs();}
  if(!chs.find(c=>c.url===s.url)){chs.push({id:Date.now(),name:s.name,url:s.url,type:s.type,cat:s.cat||'',added:new Date().toLocaleDateString('ko-KR')});save();renderAll();}
  renderPubList();toast(`âœ… "${s.name}" ì¶”ê°€ë¨`,'s');
}

// â”€â”€ RENDER â”€â”€
function renderAll(){renderCatBar();renderSB();renderGrid();renderFavs();renderRecent();document.getElementById('hint').style.display=chs.length?'none':'block';}

function renderSB(){
  const el=document.getElementById('sbch');
  let list=activeCat==='all'?chs:chs.filter(c=>c.cat===activeCat);
  if(!list.length){el.innerHTML='<div style="padding:12px 8px;font-size:12px;color:var(--text2)">ì±„ë„ì´ ì—†ìŠµë‹ˆë‹¤</div>';return;}
  el.innerHTML=list.map(c=>chItem(c)).join('');
}
function renderFavs(){
  const el=document.getElementById('sbfav');
  const fc=favs.map(id=>chs.find(c=>c.id===id)).filter(Boolean);
  if(!fc.length){el.innerHTML='<div style="padding:16px 8px;font-size:12px;color:var(--text2);text-align:center;line-height:1.8">â­ ì¦ê²¨ì°¾ê¸° ì—†ìŒ<br><span style="font-size:11px;opacity:.6">ì±„ë„ â˜† ë²„íŠ¼ìœ¼ë¡œ ì¶”ê°€</span></div>';return;}
  el.innerHTML=fc.map(c=>chItem(c)).join('');
}
function chItem(c){
  const icon=c.type==='youtube'?'â–¶':c.type==='m3u'?'ğŸ“¡':'ğŸ”—';
  const isFav=favs.includes(c.id);
  return `<div class="chi ${activeId===c.id?'on':''}" onclick='play(${sj(c)})'>
    <div class="ch-ico ${c.type}">${icon}</div>
    <div class="ch-inf"><div class="ch-nm">${c.name}</div><div class="ch-mt">${isFav?'<span style="color:var(--fav)">â˜… </span>':''}${c.cat||c.type.toUpperCase()}</div></div>
    <div class="ch-acts">
      <button class="ich ${isFav?'fon':''}" onclick="event.stopPropagation();toggleFav(${c.id})">${isFav?'â˜…':'â˜†'}</button>
      <button class="ich" onclick="removeCh(${c.id},event)">ğŸ—‘</button>
    </div>
  </div>`;
}
function renderGrid(){
  const q=document.getElementById('csearch').value.toLowerCase();
  let list=activeCat==='all'?chs:chs.filter(c=>c.cat===activeCat);
  if(q) list=list.filter(c=>c.name.toLowerCase().includes(q)||c.url.toLowerCase().includes(q));
  document.getElementById('ccount').textContent=`${list.length}ê°œ ì±„ë„`;
  const grid=document.getElementById('cgrid');
  if(!chs.length){grid.innerHTML='<div style="grid-column:1/-1;text-align:center;padding:30px;color:var(--text2)"><div style="font-size:34px;opacity:.15;margin-bottom:7px">ğŸ“¡</div><p style="font-size:13px">ì±„ë„ì„ ì¶”ê°€í•´ë³´ì„¸ìš”</p></div>';return;}
  grid.innerHTML=list.map(c=>{
    const icon=c.type==='youtube'?'â–¶':c.type==='m3u'?'ğŸ“¡':'ğŸ”—';const isFav=favs.includes(c.id);
    return `<div class="ccard ${activeId===c.id?'on':''}" onclick='play(${sj(c)})'>
      <div class="cthumb ${c.type}-bg">${icon}<div class="clive">LIVE</div>${isFav?'<div class="cfav">â˜…</div>':''}</div>
      <div class="cbody">
        <div class="cname">${c.name}</div>
        <div class="cfoot">${c.cat?`<span class="ctag">${c.cat}</span>`:'<span></span>'}<button class="dbtn" onclick="removeCh(${c.id},event)">ğŸ—‘</button></div>
      </div>
    </div>`;
  }).join('');
}

// â”€â”€ HELPERS â”€â”€
function sj(o){return JSON.stringify(o).replace(/'/g,"&#39;");}
function toast(msg,t=''){
  const el=document.createElement('div');el.className=`toast ${t}`;el.innerHTML=msg;document.body.appendChild(el);
  setTimeout(()=>{el.style.opacity='0';el.style.transition='opacity .4s';setTimeout(()=>el.remove(),400);},2400);
}

// â”€â”€ INIT â”€â”€
document.getElementById('thint').textContent=HINTS['youtube'];
if(userProxy) document.getElementById('proxyInput').value=userProxy;
updateProxyBtn();
updateProxyStatus();
renderAll();
</script>

<!-- â•â•â• í”„ë¡ì‹œ ì„¤ì • ëª¨ë‹¬ â•â•â• -->
<div class="overlay" id="m-proxy">
  <div class="modal" style="max-width:500px">
    <div class="mhead">
      <div class="mtitle">âš™ï¸ CORS í”„ë¡ì‹œ ì„¤ì •</div>
      <button class="mclose" onclick="closeM('proxy')">âœ•</button>
    </div>

    <!-- í˜„ì¬ ìƒíƒœ -->
    <div id="proxy-status" style="display:flex;align-items:center;gap:8px;padding:10px 13px;border-radius:8px;margin-bottom:14px;font-size:12px;background:var(--surface2);border:1px solid var(--border2)">
      <span id="proxy-status-dot" style="width:8px;height:8px;border-radius:50%;background:var(--text3);flex-shrink:0"></span>
      <span id="proxy-status-text" style="color:var(--text2)">í”„ë¡ì‹œ ë¯¸ì„¤ì • â€” HTTP ìŠ¤íŠ¸ë¦¼ ì¬ìƒ ë¶ˆê°€</span>
    </div>

    <!-- ì…ë ¥ -->
    <div class="fg">
      <label>í”„ë¡ì‹œ URL</label>
      <div style="display:flex;gap:6px">
        <input type="text" id="proxyInput" placeholder="https://my.leveler2.workers.dev" style="flex:1"/>
        <button class="btn btn-g btn-sm" onclick="testProxy()" style="white-space:nowrap">ğŸ” í…ŒìŠ¤íŠ¸</button>
      </div>
      <div style="font-size:10px;color:var(--text3);margin-top:5px">ëì— ìŠ¬ë˜ì‹œ(/) ì—†ì´ ì…ë ¥ Â· localStorageì— ì €ì¥ë¨</div>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ -->
    <div id="proxyTestResult" style="display:none;margin-bottom:12px;font-size:11px;padding:9px 12px;border-radius:7px;background:var(--surface2);border:1px solid var(--border2);line-height:1.7"></div>

    <!-- ë²„íŠ¼ -->
    <div class="mfoot" style="justify-content:space-between">
      <button class="btn btn-g btn-sm" onclick="clearProxy()" style="color:var(--accent2);border-color:rgba(192,57,43,.3)">ğŸ—‘ í”„ë¡ì‹œ ì‚­ì œ</button>
      <div style="display:flex;gap:6px">
        <button class="btn btn-g" onclick="closeM('proxy')">ì·¨ì†Œ</button>
        <button class="btn btn-p" onclick="saveProxy()">ğŸ’¾ ì €ì¥</button>
      </div>
    </div>
  </div>
</div>
</div>
</body>
</html>