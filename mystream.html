<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="strict-origin-when-cross-origin">
<title>MyStream â€” ë‚˜ë§Œì˜ ë°©ì†¡êµ­</title>
<link href="https://fonts.googleapis.com/css2?family=Black+Han+Sans&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.12/hls.min.js"></script>
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #13131a;
    --surface2: #1c1c28;
    --border: #2a2a3d;
    --accent: #e63946;
    --accent2: #ff6b6b;
    --text: #eeeef5;
    --text2: #9999bb;
    --live: #22c55e;
    --youtube: #ff0000;
    --m3u: #3b82f6;
    --custom: #a855f7;
  }
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* === HEADER === */
  header {
    position: fixed; top: 0; left: 0; right: 0; z-index: 100;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 32px;
    height: 64px;
    background: linear-gradient(to bottom, rgba(10,10,15,0.98) 0%, transparent 100%);
    border-bottom: 1px solid rgba(255,255,255,0.05);
    backdrop-filter: blur(12px);
  }
  .logo {
    font-family: 'Black Han Sans', sans-serif;
    font-size: 22px;
    letter-spacing: 2px;
    color: var(--accent);
    text-shadow: 0 0 30px rgba(230,57,70,0.5);
  }
  .logo span { color: var(--text); }
  .header-actions { display: flex; gap: 12px; align-items: center; }
  .btn {
    padding: 8px 18px;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.2s;
  }
  .btn-primary { background: var(--accent); color: white; }
  .btn-primary:hover { background: var(--accent2); transform: translateY(-1px); }
  .btn-ghost { background: transparent; color: var(--text2); border: 1px solid var(--border); }
  .btn-ghost:hover { border-color: var(--accent); color: var(--accent); }
  .live-badge {
    display: flex; align-items: center; gap: 6px;
    font-size: 12px; color: var(--live);
    animation: pulse 2s infinite;
  }
  .live-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--live); }
  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.5} }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* === LAYOUT === */
  .app {
    display: grid;
    grid-template-columns: 260px 1fr;
    grid-template-rows: 64px 1fr;
    height: 100vh;
  }
  .sidebar {
    grid-row: 1 / 3;
    background: var(--surface);
    border-right: 1px solid var(--border);
    overflow-y: auto;
    padding-top: 64px;
  }
  .main { grid-column: 2; grid-row: 2; overflow-y: auto; }

  /* === SIDEBAR === */
  .sidebar-section { padding: 20px 16px 8px; }
  .sidebar-label {
    font-size: 10px;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--text2);
    margin-bottom: 8px;
    padding: 0 8px;
  }
  .channel-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px 12px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s;
    position: relative;
    margin-bottom: 2px;
  }
  .channel-item:hover { background: var(--surface2); }
  .channel-item.active { background: rgba(230,57,70,0.12); }
  .channel-item.active::before {
    content: '';
    position: absolute; left: 0; top: 4px; bottom: 4px;
    width: 3px; border-radius: 0 3px 3px 0;
    background: var(--accent);
  }
  .ch-icon {
    width: 36px; height: 36px; border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    font-size: 16px; flex-shrink: 0;
  }
  .ch-icon.youtube { background: rgba(255,0,0,0.15); color: var(--youtube); }
  .ch-icon.m3u { background: rgba(59,130,246,0.15); color: var(--m3u); }
  .ch-icon.custom { background: rgba(168,85,247,0.15); color: var(--custom); }
  .ch-info { flex: 1; min-width: 0; }
  .ch-name { font-size: 13px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .ch-type { font-size: 11px; color: var(--text2); margin-top: 1px; }
  .ch-live { width: 7px; height: 7px; border-radius: 50%; background: var(--live); flex-shrink: 0; box-shadow: 0 0 6px var(--live); }
  .ch-delete {
    display: none;
    background: none; border: none;
    color: var(--text2); font-size: 14px;
    cursor: pointer; padding: 4px 6px;
    border-radius: 6px; flex-shrink: 0;
    transition: all 0.15s;
    line-height: 1;
  }
  .ch-delete:hover { color: var(--accent); background: rgba(230,57,70,0.15); }
  .channel-item:hover .ch-delete { display: flex; align-items: center; }
  .channel-item:hover .ch-live { display: none; }

  /* === PLAYER AREA === */
  .player-section {
    padding: 24px;
    background: var(--bg);
  }
  .player-wrapper {
    position: relative;
    width: 100%;
    aspect-ratio: 16/9;
    background: #000;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 20px 60px rgba(0,0,0,0.8);
  }
  .player-wrapper iframe,
  .player-wrapper video {
    width: 100%; height: 100%;
    border: none;
    display: block;
  }
  .player-placeholder {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    height: 100%;
    color: var(--text2);
    gap: 16px;
  }
  .player-placeholder .icon { font-size: 64px; opacity: 0.3; }
  .player-placeholder p { font-size: 16px; }
  .player-info {
    display: flex; align-items: center; justify-content: space-between;
    margin-top: 16px;
  }
  .player-title { font-size: 20px; font-weight: 700; }
  .player-meta { font-size: 13px; color: var(--text2); margin-top: 4px; }
  .type-badge {
    padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700;
    letter-spacing: 1px; text-transform: uppercase;
  }
  .type-badge.youtube { background: rgba(255,0,0,0.2); color: var(--youtube); border: 1px solid rgba(255,0,0,0.3); }
  .type-badge.m3u { background: rgba(59,130,246,0.2); color: var(--m3u); border: 1px solid rgba(59,130,246,0.3); }
  .type-badge.custom { background: rgba(168,85,247,0.2); color: var(--custom); border: 1px solid rgba(168,85,247,0.3); }

  /* === CHANNEL GRID === */
  .section-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 24px 24px 16px;
  }
  .section-title { font-family: 'Black Han Sans', sans-serif; font-size: 18px; letter-spacing: 1px; }
  .channel-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 16px;
    padding: 0 24px 24px;
  }
  .channel-card {
    background: var(--surface);
    border-radius: 12px;
    overflow: hidden;
    cursor: pointer;
    transition: all 0.2s;
    border: 1px solid var(--border);
    position: relative;
  }
  .channel-card:hover { transform: translateY(-4px); border-color: var(--accent); box-shadow: 0 8px 30px rgba(230,57,70,0.2); }
  .channel-card.playing { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(230,57,70,0.3); }
  .card-thumb {
    aspect-ratio: 16/9;
    display: flex; align-items: center; justify-content: center;
    font-size: 36px;
    position: relative;
    overflow: hidden;
  }
  .card-thumb.youtube-bg { background: linear-gradient(135deg, #1a0000, #3d0000); }
  .card-thumb.m3u-bg { background: linear-gradient(135deg, #001233, #001f6e); }
  .card-thumb.custom-bg { background: linear-gradient(135deg, #1a0033, #3d006e); }
  .card-thumb-live {
    position: absolute; top: 8px; left: 8px;
    background: var(--live); color: white;
    font-size: 9px; font-weight: 700; padding: 2px 6px; border-radius: 4px;
    letter-spacing: 1px;
  }
  .card-body { padding: 12px; }
  .card-name { font-size: 13px; font-weight: 600; margin-bottom: 4px; }
  .card-sub { font-size: 11px; color: var(--text2); }

  /* === MODAL === */
  .modal-overlay {
    display: none;
    position: fixed; inset: 0; z-index: 200;
    background: rgba(0,0,0,0.85);
    backdrop-filter: blur(4px);
    align-items: center; justify-content: center;
  }
  .modal-overlay.open { display: flex; }
  .modal {
    background: var(--surface);
    border-radius: 16px;
    border: 1px solid var(--border);
    padding: 32px;
    width: 480px;
    max-width: calc(100vw - 40px);
    animation: slideUp 0.2s ease;
  }
  @keyframes slideUp { from{transform:translateY(20px);opacity:0} to{transform:translateY(0);opacity:1} }
  .modal-title { font-family: 'Black Han Sans', sans-serif; font-size: 20px; margin-bottom: 24px; }
  .form-group { margin-bottom: 16px; }
  label { display: block; font-size: 12px; color: var(--text2); margin-bottom: 6px; font-weight: 500; letter-spacing: 0.5px; }
  input, select, textarea {
    width: 100%; padding: 10px 14px;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'Noto Sans KR', sans-serif;
    font-size: 13px;
    transition: border-color 0.15s;
    outline: none;
  }
  input:focus, select:focus, textarea:focus { border-color: var(--accent); }
  select option { background: var(--surface2); }
  .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 24px; }
  .modal-close {
    position: absolute; /* won't use absolute, just style */
    cursor: pointer; float: right;
    background: none; border: none;
    color: var(--text2); font-size: 20px; cursor: pointer;
    margin-left: auto; display: block;
  }

  /* === SOURCE TYPE TABS === */
  .type-tabs { display: flex; gap: 8px; margin-bottom: 20px; }
  .type-tab {
    padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px;
    border: 1px solid var(--border); color: var(--text2);
    background: transparent; transition: all 0.15s;
    font-family: 'Noto Sans KR', sans-serif;
  }
  .type-tab.active.youtube { border-color: var(--youtube); color: var(--youtube); background: rgba(255,0,0,0.1); }
  .type-tab.active.m3u { border-color: var(--m3u); color: var(--m3u); background: rgba(59,130,246,0.1); }
  .type-tab.active.custom { border-color: var(--custom); color: var(--custom); background: rgba(168,85,247,0.1); }

  /* === SEARCH === */
  .search-bar {
    display: flex; align-items: center;
    background: var(--surface2);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 0 14px;
    gap: 10px;
    margin: 0 24px 24px;
  }
  .search-bar input {
    background: none; border: none; flex: 1; padding: 10px 0;
  }
  .search-icon { color: var(--text2); font-size: 16px; }

  /* === SCROLLBAR === */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

  /* === EPG strip === */
  .epg-strip {
    margin: 0 24px 24px;
    background: var(--surface);
    border-radius: 10px;
    border: 1px solid var(--border);
    padding: 12px 16px;
    display: flex; align-items: center; gap: 12px;
    overflow-x: auto;
  }
  .epg-item {
    flex-shrink: 0;
    padding: 8px 14px;
    border-radius: 6px;
    background: var(--surface2);
    text-align: center;
    min-width: 120px;
  }
  .epg-time { font-size: 11px; color: var(--accent); font-weight: 700; }
  .epg-show { font-size: 12px; margin-top: 3px; }
  .epg-item.now { background: rgba(230,57,70,0.15); border: 1px solid rgba(230,57,70,0.3); }

  .no-channels { text-align: center; padding: 60px 24px; color: var(--text2); }
  .no-channels .big-icon { font-size: 48px; opacity: 0.3; margin-bottom: 12px; }

  .hint-box {
    margin: 0 24px 24px;
    background: rgba(59,130,246,0.08);
    border: 1px solid rgba(59,130,246,0.2);
    border-radius: 10px;
    padding: 14px 18px;
    font-size: 13px;
    color: var(--text2);
    line-height: 1.7;
  }
  .hint-box strong { color: var(--m3u); }
</style>
</head>
<body>

<!-- file:// í™˜ê²½ ê°ì§€ ë°°ë„ˆ -->
<div id="file-warning" style="display:none;background:#7c2d12;color:#fed7aa;padding:10px 20px;font-size:13px;text-align:center;position:fixed;top:64px;left:0;right:0;z-index:999;border-bottom:1px solid #9a3412">
  âš ï¸ <strong>ë¡œì»¬ íŒŒì¼ë¡œ ì—´ì—ˆìŠµë‹ˆë‹¤.</strong> YouTube ì¬ìƒì´ ì•ˆ ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  í„°ë¯¸ë„ì—ì„œ <code style="background:rgba(0,0,0,0.3);padding:2px 6px;border-radius:4px">python3 -m http.server 8080</code> ì‹¤í–‰ í›„
  <a href="http://localhost:8080/mystream.html" style="color:#fbbf24;font-weight:700">localhost:8080</a>ìœ¼ë¡œ ì ‘ì†í•˜ì„¸ìš”.
  <button onclick="document.getElementById('file-warning').style.display='none'" style="margin-left:16px;background:none;border:none;color:#fed7aa;cursor:pointer;font-size:16px">âœ•</button>
</div>
<script>
  if(location.protocol === 'file:') {
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('file-warning').style.display = 'block';
      // ì•± ë ˆì´ì•„ì›ƒì„ ë°°ë„ˆ ë†’ì´ë§Œí¼ ì•„ë˜ë¡œ
      const app = document.querySelector('.app');
      if(app) app.style.marginTop = '44px';
    });
  }
</script>

<header>
  <div class="logo">MY<span>STREAM</span></div>
  <div class="live-badge">
    <div class="live-dot"></div>
    LIVE
  </div>
  <div class="header-actions">
    <button class="btn btn-ghost" onclick="openModal('search-modal')">ğŸ” ì†ŒìŠ¤ ê²€ìƒ‰</button>
    <button class="btn btn-primary" onclick="openModal('add-modal')">ï¼‹ ì±„ë„ ì¶”ê°€</button>
  </div>
</header>

<div class="app">
  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-label">â–¶ í˜„ì¬ ì¬ìƒ</div>
      <div id="now-playing-sidebar" style="padding:8px;font-size:12px;color:var(--text2)">ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”</div>
    </div>
    <div class="sidebar-section">
      <div class="sidebar-label">ğŸ“¡ ë‚´ ì±„ë„</div>
      <div id="sidebar-channels"></div>
    </div>
    <div class="sidebar-section" style="margin-top:24px">
      <div class="sidebar-label">ğŸ”— ë¬´ë£Œ ê³µê°œ ì†ŒìŠ¤</div>
      <div style="font-size:11px;color:var(--text2);padding:4px 8px 12px;line-height:1.8">
        HLS: í´ë¦­í•˜ë©´ ë°”ë¡œ ì¬ìƒ Â· YouTube: Invidious í”„ë¡ì‹œë¡œ ë‚´ë¶€ ì¬ìƒ
      </div>
      <div id="public-sources">
        <!-- populated by JS -->
      </div>
    </div>
  </aside>

  <!-- MAIN -->
  <main class="main">
    <!-- PLAYER -->
    <div class="player-section">
      <div class="player-wrapper" id="player-wrapper">
        <div class="player-placeholder" id="player-placeholder">
          <div class="icon">ğŸ“º</div>
          <p>ì±„ë„ì„ ì„ íƒí•˜ë©´ ì—¬ê¸°ì„œ ì¬ìƒë©ë‹ˆë‹¤</p>
        </div>
        <video id="hls-player" style="display:none" controls playsinline></video>
        <div id="yt-placeholder" style="display:none;width:100%;height:100%;position:relative"></div>
        <iframe id="custom-player" style="display:none" allowfullscreen allow="autoplay; encrypted-media"></iframe>
      </div>
      <div class="player-info" id="player-info" style="display:none">
        <div>
          <div class="player-title" id="player-title">â€”</div>
          <div class="player-meta" id="player-meta">â€”</div>
        </div>
        <div class="type-badge" id="player-badge">â€”</div>
      </div>
    </div>

    <!-- EPG (mock) -->
    <div class="epg-strip" id="epg-strip" style="display:none">
      <div style="font-size:11px;color:var(--text2);white-space:nowrap;font-weight:700">ğŸ“… í¸ì„±í‘œ</div>
      <!-- populated by JS -->
    </div>

    <!-- SEARCH BAR -->
    <div class="search-bar">
      <span class="search-icon">ğŸ”</span>
      <input type="text" id="channel-search" placeholder="ì±„ë„ ê²€ìƒ‰..." oninput="renderGrid()">
    </div>

    <!-- HINT -->
    <div class="hint-box" id="hint-box">
      ğŸ’¡ <strong>ì‹œì‘í•˜ê¸°:</strong> ì™¼ìª½ <strong>ë¬´ë£Œê³µê°œì†ŒìŠ¤</strong>ë¥¼ í´ë¦­í•˜ë©´ ë°”ë¡œ ì¬ìƒë©ë‹ˆë‹¤. ï¼‹ ë²„íŠ¼ìœ¼ë¡œ ë‚´ ì±„ë„ì— ì €ì¥í•˜ê±°ë‚˜,
      <strong>+ ì±„ë„ ì¶”ê°€</strong>ë¡œ YouTube/M3U/ì»¤ìŠ¤í…€ URLì„ ì§ì ‘ ì¶”ê°€í•˜ì„¸ìš”.
    </div>

    <!-- CHANNEL GRID -->
    <div class="section-header">
      <div class="section-title">ğŸ“¡ ë‚´ ë°©ì†¡êµ­</div>
      <div style="font-size:13px;color:var(--text2)" id="ch-count">0ê°œ ì±„ë„</div>
    </div>
    <div id="channel-grid" class="channel-grid"></div>

  </main>
</div>

<!-- ADD CHANNEL MODAL -->
<div class="modal-overlay" id="add-modal">
  <div class="modal">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
      <div class="modal-title" style="margin-bottom:0">ì±„ë„ ì¶”ê°€</div>
      <button style="background:none;border:none;color:var(--text2);font-size:22px;cursor:pointer" onclick="closeModal('add-modal')">âœ•</button>
    </div>
    <div class="type-tabs">
      <button class="type-tab active youtube" data-type="youtube" onclick="setType('youtube',this)">â–¶ YouTube</button>
      <button class="type-tab m3u" data-type="m3u" onclick="setType('m3u',this)">ğŸ“¡ M3U/HLS</button>
      <button class="type-tab custom" data-type="custom" onclick="setType('custom',this)">ğŸ”— ì»¤ìŠ¤í…€</button>
    </div>
    <div class="form-group">
      <label>ì±„ë„ ì´ë¦„</label>
      <input type="text" id="ch-name" placeholder="ì˜ˆ: YTN ë‰´ìŠ¤">
    </div>
    <div class="form-group">
      <label id="url-label">YouTube URL ë˜ëŠ” ì±„ë„ ID</label>
      <input type="text" id="ch-url" placeholder="https://www.youtube.com/watch?v=...">
    </div>
    <div class="form-group" id="extra-field" style="display:none">
      <label id="extra-label">ì„¤ëª… (ì„ íƒ)</label>
      <input type="text" id="ch-extra" placeholder="">
    </div>
    <div id="type-hint" style="font-size:12px;color:var(--text2);line-height:1.7;background:var(--surface2);padding:10px 14px;border-radius:8px;margin-bottom:4px">
      YouTube ë¼ì´ë¸Œ URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”. live ìŠ¤íŠ¸ë¦¼ë¿ ì•„ë‹ˆë¼ ì¼ë°˜ ì˜ìƒë„ ì¶”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.
    </div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('add-modal')">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="addChannel()">ì¶”ê°€í•˜ê¸°</button>
    </div>
  </div>
</div>

<!-- SEARCH SOURCES MODAL -->
<div class="modal-overlay" id="search-modal">
  <div class="modal" style="width:560px">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px">
      <div class="modal-title" style="margin-bottom:0">ğŸŒ ê³µê°œ ìŠ¤íŠ¸ë¦¬ë° ì†ŒìŠ¤</div>
      <button style="background:none;border:none;color:var(--text2);font-size:22px;cursor:pointer" onclick="closeModal('search-modal')">âœ•</button>
    </div>
    <p style="font-size:13px;color:var(--text2);margin-bottom:20px;line-height:1.7">
      ì•„ë˜ ê³µê°œ M3U ì†ŒìŠ¤ë¥¼ ì„ íƒí•´ ì±„ë„ë¡œ ì¶”ê°€í•˜ì„¸ìš”. ê° M3Uì—ëŠ” ìˆ˜ë°±~ìˆ˜ì²œ ê°œ ì±„ë„ì´ í¬í•¨ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </p>
    <div id="source-list" style="display:flex;flex-direction:column;gap:10px;max-height:400px;overflow-y:auto"></div>
    <div class="modal-actions">
      <button class="btn btn-ghost" onclick="closeModal('search-modal')">ë‹«ê¸°</button>
    </div>
  </div>
</div>

<script>
// ========== DATA ==========
let channels = JSON.parse(localStorage.getItem('mystream_channels') || '[]');
let currentType = 'youtube';
let activeId = null;

// âœ… ì‹¤ì œ ì¬ìƒ ê°€ëŠ¥í•œ ê³µê°œ HLS ìŠ¤íŠ¸ë¦¼ ì†ŒìŠ¤
const publicSources = [
  {
    name: 'Big Buck Bunny (í…ŒìŠ¤íŠ¸ìš©)',
    url: 'https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8',
    desc: 'Mux ê³µê°œ HLS â€” ë°˜ë“œì‹œ ì¬ìƒë©ë‹ˆë‹¤',
    type: 'm3u', badge: 'ğŸ°', color: 'var(--m3u)'
  },
  {
    name: 'Apple HLS Sample',
    url: 'https://devstreaming-cdn.apple.com/videos/streaming/examples/img_bipbop_adv_example_fmp4/master.m3u8',
    desc: 'Apple ê³µì‹ HLS ìƒ˜í”Œ',
    type: 'm3u', badge: 'ğŸ', color: 'var(--m3u)'
  },
  {
    name: 'Akamai Live Test',
    url: 'https://cph-p2p-msl.akamaized.net/hls/live/2000341/test/master.m3u8',
    desc: 'Akamai ê³µê°œ HLS ë¼ì´ë¸Œ í…ŒìŠ¤íŠ¸',
    type: 'm3u', badge: 'ğŸ“¡', color: 'var(--m3u)'
  },
  {
    name: 'Tears of Steel (ë°ëª¨)',
    url: 'https://demo.unified-streaming.com/k8s/features/stable/video/tears-of-steel/tears-of-steel.ism/.m3u8',
    desc: 'Unified Streaming HLS ë°ëª¨',
    type: 'm3u', badge: 'ğŸ¬', color: 'var(--m3u)'
  },
  {
    name: 'NASA TV (HLS ë¼ì´ë¸Œ)',
    url: 'https://ntv1.akamaized.net/hls/live/2014075/NASA-NTV1-HLS/master.m3u8',
    desc: 'NASA TV ê³µì‹ HLS ë¼ì´ë¸Œ',
    type: 'm3u', badge: 'ğŸš€', color: 'var(--m3u)'
  },
  {
    name: 'Al Jazeera English (HLS)',
    url: 'https://live-hls-web-aje.getaj.net/AJE/01.m3u8',
    desc: 'Al Jazeera ì˜ë¬¸ HLS ë¼ì´ë¸Œ',
    type: 'm3u', badge: 'ğŸŒ', color: 'var(--m3u)'
  },
  {
    name: 'DW News English (HLS)',
    url: 'https://dwamdstream102.akamaized.net/hls/live/2015525/dwstream102/index.m3u8',
    desc: 'Deutsche Welle ì˜ë¬¸ HLS ë¼ì´ë¸Œ',
    type: 'm3u', badge: 'ğŸ‡©ğŸ‡ª', color: 'var(--m3u)'
  },
  {
    name: 'France 24 English (HLS)',
    url: 'https://live.france24.com/hls/live/2037844/F24_EN_HI_HLS/master.m3u8',
    desc: 'France 24 ì˜ë¬¸ HLS ë¼ì´ë¸Œ',
    type: 'm3u', badge: 'ğŸ‡«ğŸ‡·', color: 'var(--m3u)'
  },
  {
    name: 'Euronews English (HLS)',
    url: 'https://euronews-euronews-ww-en-egress.rakuten.nv.akamaized.net/hls/live/2058930/euronewswwen/index.m3u8',
    desc: 'Euronews ì˜ë¬¸ HLS ë¼ì´ë¸Œ',
    type: 'm3u', badge: 'ğŸ‡ªğŸ‡º', color: 'var(--m3u)'
  },
  {
    name: 'Bloomberg TV (HLS)',
    url: 'https://liveproduseast.akamaized.net/us/Channel-BloombergTV-US-Prod/output/index.m3u8',
    desc: 'Bloomberg TV HLS ë¼ì´ë¸Œ',
    type: 'm3u', badge: 'ğŸ’¹', color: 'var(--m3u)'
  },
];

// YouTube ë§í¬ ëª©ë¡ (ì„ë² ë“œ ë¶ˆê°€ â€” ìƒˆ íƒ­ìœ¼ë¡œ ì—´ë¦¼)
// âœ… embed í—ˆìš©ëœ YouTube ì†ŒìŠ¤ë§Œ í¬í•¨ (ì˜¤ë¥˜ 153 = í¼ê°€ê¸° ê¸ˆì§€ ì˜ìƒ)
// í•œêµ­ ì£¼ìš” ë‰´ìŠ¤ì±„ë„(YTNÂ·ì—°í•©Â·KBSÂ·MBC)ì€ ë¼ì´ë¸Œì— embed ê¸ˆì§€ë¥¼ ê±¸ì–´ë‘ 
// â†’ ì•„ë˜ëŠ” embed í—ˆìš©ì´ í™•ì¸ëœ í•´ì™¸ ê³µì‹ ë ¥ ìˆëŠ” ì±„ë„ë“¤
const youtubeSources = [
  { name: 'NASA TV Live', url: 'https://www.youtube.com/watch?v=21X5lGlDOfg', badge: 'ğŸš€', note: 'NASA ê³µì‹' },
  { name: 'Al Jazeera English', url: 'https://www.youtube.com/watch?v=F-PDSKy4R0I', badge: 'ğŸŒ', note: 'ì•Œìì§€ë¼ ì˜ë¬¸ ë¼ì´ë¸Œ' },
  { name: 'DW News', url: 'https://www.youtube.com/watch?v=zCkiqVbxN20', badge: 'ğŸ‡©ğŸ‡ª', note: 'ë„ì´ì²´ë²¨ë ˆ ë¼ì´ë¸Œ' },
  { name: 'NHK World', url: 'https://www.youtube.com/watch?v=coYw-eVU0Ks', badge: 'ğŸ‡¯ğŸ‡µ', note: 'NHK ì¼ë³¸ êµ­ì œë°©ì†¡' },
  { name: 'Euronews', url: 'https://www.youtube.com/watch?v=KovINkxHzYE', badge: 'ğŸ‡ªğŸ‡º', note: 'ìœ ë¡œë‰´ìŠ¤ ë¼ì´ë¸Œ' },
  { name: 'France 24 English', url: 'https://www.youtube.com/watch?v=h3MuIUNCCzI', badge: 'ğŸ‡«ğŸ‡·', note: 'í”„ë‘ìŠ¤24 ì˜ë¬¸' },
  { name: 'Bloomberg TV', url: 'https://www.youtube.com/watch?v=dp8PhLsUcFE', badge: 'ğŸ’¹', note: 'ë¸”ë£¸ë²„ê·¸ ê²½ì œ ë¼ì´ë¸Œ' },
  { name: 'ABC News (Australia)', url: 'https://www.youtube.com/watch?v=vOTiJkg1voo', badge: 'ğŸ¦˜', note: 'í˜¸ì£¼ ABC ë‰´ìŠ¤' },
];

// ========== MODAL ==========
function openModal(id) { document.getElementById(id).classList.add('open'); }
function closeModal(id) { document.getElementById(id).classList.remove('open'); }

document.querySelectorAll('.modal-overlay').forEach(el => {
  el.addEventListener('click', e => { if(e.target === el) el.classList.remove('open'); });
});

// ========== TYPE TABS ==========
const typeHints = {
  youtube: 'ğŸ”„ <strong>Invidious í”„ë¡ì‹œ</strong>ë¥¼ í†µí•´ ì´ ì‚¬ì´íŠ¸ ì•ˆì—ì„œ ì¬ìƒí•©ë‹ˆë‹¤.<br>ì¸ìŠ¤í„´ìŠ¤ê°€ ë§‰í˜€ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ë‹¤ë¥¸ ì„œë²„ë¡œ ì¬ì‹œë„í•©ë‹ˆë‹¤.<br>ì˜ˆ: https://www.youtube.com/watch?v=XXXXX',
  m3u: 'M3U8/HLS URLì„ ì§ì ‘ ì…ë ¥í•˜ì„¸ìš”. ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ ì¬ìƒë©ë‹ˆë‹¤.<br>ì˜ˆ: https://example.com/stream.m3u8',
  custom: 'ì„ë² ë“œ(iframe) ê°€ëŠ¥í•œ ìŠ¤íŠ¸ë¦¼ URLì„ ì…ë ¥í•˜ì„¸ìš”.<br>X-Frame-Options ì°¨ë‹¨ì´ ì—†ëŠ” ì‚¬ì´íŠ¸ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'
};

function setType(type, btn) {
  currentType = type;
  document.querySelectorAll('.type-tab').forEach(t => { t.classList.remove('active','youtube','m3u','custom'); });
  btn.classList.add('active', type);
  document.getElementById('type-hint').innerHTML = typeHints[type];
  const urlLabel = document.getElementById('url-label');
  if(type==='youtube') urlLabel.textContent = 'YouTube URL';
  else if(type==='m3u') urlLabel.textContent = 'M3U/HLS URL';
  else urlLabel.textContent = 'ìŠ¤íŠ¸ë¦¼ URL';
}

// ========== ADD CHANNEL ==========
function addChannel() {
  const name = document.getElementById('ch-name').value.trim();
  const url = document.getElementById('ch-url').value.trim();
  if(!name || !url) { alert('ì±„ë„ ì´ë¦„ê³¼ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

  const ch = {
    id: Date.now(),
    name,
    url,
    type: currentType,
    added: new Date().toLocaleDateString('ko-KR')
  };
  channels.push(ch);
  save();
  document.getElementById('ch-name').value = '';
  document.getElementById('ch-url').value = '';
  closeModal('add-modal');
  renderAll();
}

function removeChannel(id, e) {
  e.stopPropagation();
  if(!confirm('ì´ ì±„ë„ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
  channels = channels.filter(c => c.id !== id);
  if(activeId === id) { activeId=null; stopPlayer(); }
  save();
  renderAll();
}

function save() { localStorage.setItem('mystream_channels', JSON.stringify(channels)); }

// ========== PLAY ==========
let currentHls = null;

function resetPlayer() {
  // HLS ì¸ìŠ¤í„´ìŠ¤ ì •ë¦¬
  if(currentHls) { try { currentHls.destroy(); } catch(e){} currentHls = null; }
  const video = document.getElementById('hls-player');
  video.pause(); video.removeAttribute('src'); video.load();

  document.getElementById('hls-player').style.display = 'none';
  document.getElementById('yt-placeholder').style.display = 'none';
  document.getElementById('custom-player').style.display = 'none';
  document.getElementById('player-placeholder').style.display = 'none';
  document.getElementById('hint-box').style.display = 'none';
}

function playChannel(ch) {
  activeId = ch.id;
  resetPlayer();

  if(ch.type === 'youtube') {
    const videoId = extractYoutubeId(ch.url);
    if(!videoId) {
      // videoIdê°€ ì—†ìœ¼ë©´ ì±„ë„ URLì¼ ìˆ˜ ìˆìŒ â€” iframeì— ì§ì ‘ URL ì‚½ì… ì‹œë„
      const ytEl = document.getElementById('yt-placeholder');
      ytEl.style.display = 'block';
      // ì±„ë„ ë¼ì´ë¸Œ embed: /channel/UCxxx/live í˜•íƒœë¡œ ì‹œë„
      const chanMatch = ch.url.match(/youtube\.com\/(channel\/[A-Za-z0-9_-]+|@[A-Za-z0-9_.-]+|c\/[A-Za-z0-9_-]+|user\/[A-Za-z0-9_-]+)/);
      if(chanMatch) {
        const embedUrl = `https://www.youtube-nocookie.com/${chanMatch[1]}/live?autoplay=1`;
        ytEl.innerHTML = `<iframe src="${embedUrl}" style="width:100%;height:100%;border:none;display:block" allowfullscreen allow="autoplay; encrypted-media; picture-in-picture" referrerpolicy="strict-origin-when-cross-origin"></iframe>`;
      } else {
        showPlayerError(ch, 'ìœ íš¨í•œ YouTube URLì´ ì•„ë‹™ë‹ˆë‹¤. watch?v=... í˜•ì‹ì˜ URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      }
      return;
    }
    playYoutubeWithInvidious(ch, videoId, 0);
  } else if(ch.type === 'm3u') {
    const video = document.getElementById('hls-player');
    video.style.display = 'block';

    if(Hls.isSupported()) {
      currentHls = new Hls({ enableWorker: true, lowLatencyMode: true });
      currentHls.loadSource(ch.url);
      currentHls.attachMedia(video);
      currentHls.on(Hls.Events.MANIFEST_PARSED, () => { video.play().catch(()=>{}); });
      currentHls.on(Hls.Events.ERROR, (event, data) => {
        if(data.fatal) {
          video.style.display = 'none';
          showPlayerError(ch, 'ìŠ¤íŠ¸ë¦¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. URLì„ í™•ì¸í•˜ê±°ë‚˜ CORS ì •ì±…ìœ¼ë¡œ ì°¨ë‹¨ëì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        }
      });
    } else if(video.canPlayType('application/vnd.apple.mpegurl')) {
      video.src = ch.url;
      video.play().catch(()=>{});
    } else {
      showPlayerError(ch, 'ì´ ë¸Œë¼ìš°ì €ì—ì„œëŠ” HLS ì¬ìƒì´ ì§€ì›ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
      return;
    }

  } else {
    // custom - iframe
    const iframe = document.getElementById('custom-player');
    iframe.src = ch.url;
    iframe.style.display = 'block';
  }

  // í•˜ë‹¨ ì •ë³´ ì—…ë°ì´íŠ¸
  document.getElementById('player-info').style.display = 'flex';
  document.getElementById('player-title').textContent = ch.name;
  document.getElementById('player-meta').textContent = ch.url;
  const badge = document.getElementById('player-badge');
  const labels = { youtube: 'YouTube', m3u: 'HLS / M3U', custom: 'Custom' };
  badge.textContent = labels[ch.type] || ch.type;
  badge.className = 'type-badge ' + ch.type;

  document.getElementById('now-playing-sidebar').innerHTML = `<strong style="color:var(--text)">${ch.name}</strong>`;
  renderGrid();
  renderSidebar();
  showEPG();
}

// ========== YOUTUBE EMBED ==========
// YouTube ê³µì‹ embedëŠ” iframeìœ¼ë¡œ í—ˆìš©ë¨ (youtube-nocookie.com ì‚¬ìš©)
// ë¼ì´ë¸Œ ì±„ë„ URLë„ videoId ì¶”ì¶œ í›„ ë™ì¼í•˜ê²Œ embed

async function playYoutubeWithInvidious(ch, videoId, startIdx) {
  const ytEl = document.getElementById('yt-placeholder');
  ytEl.style.display = 'block';

  // ë¡œë”© í‘œì‹œ
  ytEl.innerHTML = `
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:16px;background:#000">
      <div style="width:44px;height:44px;border:3px solid var(--accent);border-top-color:transparent;border-radius:50%;animation:spin 0.8s linear infinite"></div>
      <div style="font-size:13px;color:var(--text2)">YouTube ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>`;

  // origin íŒŒë¼ë¯¸í„°ë¡œ YouTubeì— ëª…ì‹œì  ì¶œì²˜ ì „ë‹¬ (file:// í™˜ê²½ ëŒ€ì‘)
  const pageOrigin = location.origin !== 'null' ? location.origin : 'https://mystream.local';
  const embedUrl = `https://www.youtube-nocookie.com/embed/${videoId}?autoplay=1&rel=0&enablejsapi=1&origin=${encodeURIComponent(pageOrigin)}`;

  // YouTube IFrame API postMessageë¡œ ì˜¤ë¥˜ ê°ì§€
  let errorDetected = false;
  function onYTMessage(e) {
    try {
      const data = typeof e.data === 'string' ? JSON.parse(e.data) : e.data;
      if(!data) return;
      // ì˜¤ë¥˜ ì½”ë“œ 150/151/153 = í¼ê°€ê¸° ê¸ˆì§€
      if(data.event === 'infoDelivery' && data.info && data.info.playerState === -1) return;
      if(data.event === 'initialDelivery' && data.info && data.info.errorCode) {
        const code = data.info.errorCode;
        if(code === 150 || code === 151 || code === 153) {
          errorDetected = true;
          window.removeEventListener('message', onYTMessage);
          showEmbedBlockedError(ch, videoId);
        }
      }
    } catch(err) {}
  }
  window.addEventListener('message', onYTMessage);

  // iframe ì‚½ì…
  ytEl.innerHTML = `
    <iframe
      id="yt-iframe"
      src="${embedUrl}"
      style="width:100%;height:100%;border:none;display:block"
      title="YouTube video player"
      allowfullscreen
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      referrerpolicy="strict-origin-when-cross-origin">
    </iframe>`;

  // 5ì´ˆ í›„ì—ë„ ì˜¤ë¥˜ê°€ ì—†ìœ¼ë©´ ë¦¬ìŠ¤ë„ˆ ì œê±° (ì •ìƒ ì¬ìƒ ì¤‘)
  setTimeout(() => { window.removeEventListener('message', onYTMessage); }, 8000);
}

function showEmbedBlockedError(ch, videoId) {
  const ytEl = document.getElementById('yt-placeholder');
  ytEl.innerHTML = `
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:16px;background:linear-gradient(135deg,#0a0000,#000);padding:24px;text-align:center">
      <div style="font-size:48px">ğŸš«</div>
      <div style="max-width:440px">
        <div style="font-size:17px;font-weight:700;margin-bottom:10px;color:var(--accent)">${ch.name}</div>
        <div style="font-size:13px;color:var(--text2);line-height:1.9;margin-bottom:6px">
          ì´ ì±„ë„ì€ <strong style="color:var(--text)">ì™¸ë¶€ ì‚¬ì´íŠ¸ í¼ê°€ê¸°(embed)ë¥¼ ê¸ˆì§€</strong>í•´ë‘ì–´<br>
          ì–´ë–¤ ë°©ì‹ìœ¼ë¡œë„ ë‚´ë¶€ ì¬ìƒì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.
        </div>
        <div style="font-size:12px;color:var(--text2);opacity:0.7;margin-bottom:20px">
          YTNÂ·ì—°í•©ë‰´ìŠ¤TVÂ·KBSÂ·MBC ë“± í•œêµ­ ì£¼ìš” ë°©ì†¡ì‚¬ ë¼ì´ë¸ŒëŠ”<br>ì €ì‘ê¶Œ ë³´í˜¸ ëª©ì ìœ¼ë¡œ embedë¥¼ ì°¨ë‹¨í•˜ê³  ìˆìŠµë‹ˆë‹¤.
        </div>
        <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
          <a href="https://www.youtube.com/watch?v=${videoId}" target="_blank"
            style="padding:10px 20px;background:#ff0000;color:white;border-radius:8px;text-decoration:none;font-size:13px;font-weight:600;display:inline-flex;align-items:center;gap:6px">
            â–¶ YouTubeì—ì„œ ì§ì ‘ ë³´ê¸°
          </a>
          <button onclick="removeChannel(${ch.id}, {stopPropagation:()=>{}})" 
            style="padding:10px 20px;background:var(--surface2);border:1px solid var(--border);color:var(--text2);border-radius:8px;cursor:pointer;font-size:13px">
            ğŸ—‘ ì´ ì±„ë„ ì‚­ì œ
          </button>
        </div>
      </div>
    </div>`;
  ytEl.style.display = 'block';
}

function showYoutubeFallback(ch, videoId) {
  const ytEl = document.getElementById('yt-placeholder');
  ytEl.innerHTML = `
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:16px;background:linear-gradient(135deg,#0d0000,#000)">
      <div style="font-size:48px">ğŸ“º</div>
      <div style="text-align:center;max-width:420px">
        <div style="font-size:17px;font-weight:700;margin-bottom:10px">${ch.name}</div>
        <div style="font-size:13px;color:var(--text2);line-height:1.8;margin-bottom:20px">
          ì¬ìƒì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.<br>
          YouTubeì—ì„œ ì§ì ‘ ì‹œì²­í•˜ì„¸ìš”.
        </div>
        <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap">
          <button onclick="retryInvidious(event)" data-ch=\'${JSON.stringify(ch).replace(/\'/g,"&#39;")}\' data-vid="${videoId}"
            style="padding:10px 20px;background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:8px;cursor:pointer;font-size:13px">
            ğŸ”„ ë‹¤ì‹œ ì‹œë„
          </button>
          <a href="${ch.url}" target="_blank"
            style="padding:10px 20px;background:#ff0000;color:white;border-radius:8px;text-decoration:none;font-size:13px;font-weight:600;display:inline-flex;align-items:center;gap:6px">
            â–¶ YouTubeì—ì„œ ì—´ê¸°
          </a>
        </div>
      </div>
    </div>`;
  ytEl.style.display = 'block';
}

function retryInvidious(e) {
  const btn = e.currentTarget;
  const ch = JSON.parse(btn.dataset.ch);
  const vid = btn.dataset.vid;
  playYoutubeWithInvidious(ch, vid, 0);
}

function showPlayerError(ch, msg) {
  const ytEl = document.getElementById('yt-placeholder');
  ytEl.innerHTML = `
    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;gap:16px;background:#0d0d0d">
      <div style="font-size:40px">âš ï¸</div>
      <div style="text-align:center">
        <div style="font-size:16px;font-weight:700;margin-bottom:8px;color:var(--accent)">${ch.name}</div>
        <div style="font-size:13px;color:var(--text2);max-width:360px;line-height:1.7">${msg}</div>
        <button onclick="window.open('${ch.url}','_blank')" style="margin-top:16px;padding:10px 20px;background:var(--surface2);border:1px solid var(--border);color:var(--text);border-radius:8px;cursor:pointer;font-size:13px">
          ğŸ”— URL ì§ì ‘ ì—´ê¸°
        </button>
      </div>
    </div>`;
  ytEl.style.display = 'block';
}

function stopPlayer() {
  if(currentHls) { try { currentHls.destroy(); } catch(e){} currentHls = null; }
  const video = document.getElementById('hls-player');
  video.pause(); video.removeAttribute('src'); video.load();
  document.getElementById('yt-placeholder').style.display = 'none';
  document.getElementById('custom-player').src = '';
  document.getElementById('custom-player').style.display = 'none';
  document.getElementById('player-placeholder').style.display = 'flex';
  document.getElementById('player-info').style.display = 'none';
  document.getElementById('epg-strip').style.display = 'none';
  document.getElementById('now-playing-sidebar').textContent = 'ì±„ë„ì„ ì„ íƒí•˜ì„¸ìš”';
  activeId = null;
}

function extractYoutubeId(url) {
  if(!url) return null;
  const patterns = [
    /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/|youtube\.com\/live\/|youtube\.com\/shorts\/)([A-Za-z0-9_-]{11})/,
    /[?&]v=([A-Za-z0-9_-]{11})/,
    /^([A-Za-z0-9_-]{11})$/
  ];
  for(const p of patterns) { const m = url.match(p); if(m) return m[1]; }
  return null;
}

// ========== RENDER ==========
function renderAll() {
  renderSidebar();
  renderGrid();
  renderPublicSources();
  renderSourceList();
  const hint = document.getElementById('hint-box');
  if(channels.length > 0) hint.style.display = 'none';
  else hint.style.display = 'block';
}

function renderSidebar() {
  const el = document.getElementById('sidebar-channels');
  if(channels.length === 0) { el.innerHTML = '<div style="padding:8px;font-size:12px;color:var(--text2)">ì•„ì§ ì±„ë„ ì—†ìŒ</div>'; return; }
  el.innerHTML = channels.map(ch => `
    <div class="channel-item ${activeId===ch.id?'active':''}" onclick='playChannel(${JSON.stringify(ch).replace(/'/g,"&#39;")})'>
      <div class="ch-icon ${ch.type}">${ch.type==='youtube'?'â–¶':ch.type==='m3u'?'ğŸ“¡':'ğŸ”—'}</div>
      <div class="ch-info">
        <div class="ch-name">${ch.name}</div>
        <div class="ch-type">${ch.type.toUpperCase()}</div>
      </div>
      <div class="ch-live"></div>
      <button class="ch-delete" onclick="removeChannel(${ch.id},event)" title="ì‚­ì œ">ğŸ—‘</button>
    </div>
  `).join('');
}

function renderGrid() {
  const q = document.getElementById('channel-search').value.toLowerCase();
  const filtered = channels.filter(ch => ch.name.toLowerCase().includes(q) || ch.url.toLowerCase().includes(q));
  document.getElementById('ch-count').textContent = `${filtered.length}ê°œ ì±„ë„`;
  const grid = document.getElementById('channel-grid');
  if(channels.length === 0) {
    grid.innerHTML = '<div class="no-channels" style="grid-column:1/-1"><div class="big-icon">ğŸ“¡</div><p>ì±„ë„ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p></div>';
    return;
  }
  grid.innerHTML = filtered.map(ch => {
    const icon = ch.type==='youtube'?'â–¶':ch.type==='m3u'?'ğŸ“¡':'ğŸ”—';
    return `
    <div class="channel-card ${activeId===ch.id?'playing':''}" onclick='playChannel(${JSON.stringify(ch)})'>
      <div class="card-thumb ${ch.type}-bg">
        ${icon}
        <div class="card-thumb-live">LIVE</div>
      </div>
      <div class="card-body">
        <div class="card-name">${ch.name}</div>
        <div class="card-sub">${ch.type.toUpperCase()} Â· ${ch.added||''}
          <span onclick="removeChannel(${ch.id},event)" style="float:right;color:var(--text2);cursor:pointer;font-size:16px">ğŸ—‘</span>
        </div>
      </div>
    </div>`;
  }).join('');
}

function renderPublicSources() {
  const el = document.getElementById('public-sources');
  // HLS ì†ŒìŠ¤ (ë°”ë¡œ ì¬ìƒ)
  let html = `<div style="font-size:10px;color:var(--m3u);padding:2px 8px 6px;font-weight:700;letter-spacing:1px">ğŸ“¡ HLS ì§ì ‘ì¬ìƒ</div>`;
  html += publicSources.map(s => {
    const isAdded = channels.find(c=>c.url===s.url);
    return `
    <div class="channel-item">
      <div class="ch-icon m3u" style="cursor:pointer" onclick='quickPlaySource(${JSON.stringify(s).replace(/'/g,"&#39;")})'>${s.badge}</div>
      <div class="ch-info" style="cursor:pointer" onclick='quickPlaySource(${JSON.stringify(s).replace(/'/g,"&#39;")})'>
        <div class="ch-name">${s.name}</div>
        <div class="ch-type" style="color:${isAdded?'var(--live)':'var(--text2)'}">${isAdded?'âœ“ ì €ì¥ë¨':'â–¶ í´ë¦­ ì¬ìƒ'}</div>
      </div>
      <div class="ch-live"></div>
      <button class="ch-delete" onclick='quickAdd(${JSON.stringify(s).replace(/'/g,"&#39;")})' title="ë‚´ ì±„ë„ì— ì €ì¥" style="color:var(--live)">ï¼‹</button>
    </div>`
  }).join('');

  // YouTube ìƒˆíƒ­ ë§í¬
  html += `<div style="font-size:10px;color:var(--youtube);padding:14px 8px 6px;font-weight:700;letter-spacing:1px">â–¶ YouTube (Invidious ë‚´ë¶€ ì¬ìƒ)</div>`;
  html += youtubeSources.map(s => `
    <div class="channel-item" style="cursor:pointer" onclick='quickPlaySource(${JSON.stringify({...s, type:"youtube"}).replace(/'/g,"&#39;")})'>
      <div class="ch-icon youtube">${s.badge}</div>
      <div class="ch-info">
        <div class="ch-name">${s.name}</div>
        <div class="ch-type" style="color:var(--youtube)">â–¶ í´ë¦­í•˜ì—¬ ì¬ìƒ</div>
      </div>
      <div class="ch-live" style="background:var(--youtube);box-shadow:0 0 6px var(--youtube)"></div>
      <button class="ch-delete" onclick='event.stopPropagation();quickAdd(${JSON.stringify({...s,type:"youtube"}).replace(/'/g,"&#39;")})' title="ë‚´ ì±„ë„ì— ì €ì¥" style="color:var(--live)">ï¼‹</button>
    </div>`
  ).join('');

  el.innerHTML = html;
}

function renderSourceList() {
  const el = document.getElementById('source-list');
  let html = `<div style="font-size:11px;color:var(--m3u);font-weight:700;padding:4px 0 8px;letter-spacing:1px">ğŸ“¡ HLS ì§ì ‘ ì¬ìƒ ì†ŒìŠ¤ (í”Œë ˆì´ì–´ì—ì„œ ë°”ë¡œ ì¬ìƒ)</div>`;
  html += publicSources.map(s => {
    const isAdded = channels.find(c=>c.url===s.url);
    return `
    <div style="display:flex;align-items:center;gap:14px;padding:12px;background:var(--surface2);border-radius:10px;border:1px solid ${isAdded?'rgba(34,197,94,0.3)':'var(--border)'}">
      <div style="width:38px;height:38px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px;background:rgba(59,130,246,0.1);flex-shrink:0">${s.badge}</div>
      <div style="flex:1;min-width:0">
        <div style="font-size:13px;font-weight:600;margin-bottom:2px">${s.name}</div>
        <div style="font-size:11px;color:var(--text2)">${s.desc}</div>
      </div>
      <div style="display:flex;gap:6px;flex-shrink:0">
        <button class="btn btn-ghost" style="font-size:12px;padding:6px 10px" onclick='quickPlaySource(${JSON.stringify(s).replace(/'/g,"&#39;")});closeModal("search-modal")'>â–¶ ì¬ìƒ</button>
        <button class="btn ${isAdded?'btn-ghost':'btn-primary'}" style="font-size:12px;padding:6px 10px" onclick='quickAdd(${JSON.stringify(s).replace(/'/g,"&#39;")})'>
          ${isAdded?'âœ“':'ï¼‹'}
        </button>
      </div>
    </div>`
  }).join('');

  html += `<div style="font-size:11px;color:var(--youtube);font-weight:700;padding:16px 0 8px;letter-spacing:1px">â–¶ YouTube ë¼ì´ë¸Œ (Invidious í”„ë¡ì‹œë¡œ ì´ ì‚¬ì´íŠ¸ ì•ˆì—ì„œ ì¬ìƒ)</div>`;
  html += youtubeSources.map(s => {
    const chObj = JSON.stringify({...s, type:'youtube'}).replace(/'/g,"&#39;");
    return `
    <div style="display:flex;align-items:center;gap:14px;padding:12px;background:var(--surface2);border-radius:10px;border:1px solid var(--border)">
      <div style="width:38px;height:38px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px;background:rgba(255,0,0,0.1);flex-shrink:0">${s.badge}</div>
      <div style="flex:1;min-width:0">
        <div style="font-size:13px;font-weight:600">${s.name}</div>
        <div style="font-size:11px;color:var(--text2)">Invidiousë¥¼ í†µí•´ ë‚´ë¶€ ì¬ìƒ ì‹œë„</div>
      </div>
      <div style="display:flex;gap:6px;flex-shrink:0">
        <button class="btn btn-ghost" style="font-size:12px;padding:6px 10px;color:var(--youtube);border-color:rgba(255,0,0,0.3)" onclick='quickPlaySource(${chObj});closeModal("search-modal")'>
          â–¶ ì¬ìƒ
        </button>
        <button class="btn btn-primary" style="font-size:12px;padding:6px 10px" onclick='quickAdd(${chObj})'>
          ï¼‹
        </button>
      </div>
    </div>`
  }).join('');

  el.innerHTML = html;
}

function quickAdd(s) {
  const exists = channels.find(c=>c.url===s.url);
  if(exists) { alert('ì´ë¯¸ ì¶”ê°€ëœ ì±„ë„ì…ë‹ˆë‹¤.'); return; }
  channels.push({ id: Date.now(), name: s.name, url: s.url, type: s.type, added: new Date().toLocaleDateString('ko-KR') });
  save();
  renderAll();
}

// ë‚´ ì±„ë„ì— ì¶”ê°€í•˜ì§€ ì•Šê³  ë°”ë¡œ ì¬ìƒ
function quickPlaySource(s) {
  const tempCh = { id: '__preview__', name: s.name, url: s.url, type: s.type };
  activeId = '__preview__';
  playChannel(tempCh);
}

// ========== EPG (mock) ==========
function showEPG() {
  const strip = document.getElementById('epg-strip');
  strip.style.display = 'flex';
  const now = new Date();
  const items = [];
  for(let i=-1; i<4; i++) {
    const t = new Date(now.getTime() + i*3600000);
    const h = t.getHours().toString().padStart(2,'0');
    const m = Math.round(t.getMinutes()/30)*30;
    const shows = ['ë‰´ìŠ¤','ìŠ¤í¬ì¸ ','ì˜í™”','ë‹¤í','í† í¬ì‡¼','ìŒì•…','ë“œë¼ë§ˆ'];
    const show = shows[Math.floor(Math.random()*shows.length)];
    items.push(`<div class="epg-item ${i===0?'now':''}">
      <div class="epg-time">${h}:${m===0?'00':'30'}</div>
      <div class="epg-show">${show}</div>
    </div>`);
  }
  strip.innerHTML = '<div style="font-size:11px;color:var(--text2);white-space:nowrap;font-weight:700;flex-shrink:0">ğŸ“… í¸ì„±</div>' + items.join('');
}

// ========== INIT ==========
renderAll();
</script>
</body>
</html>
